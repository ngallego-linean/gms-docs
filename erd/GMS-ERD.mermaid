erDiagram

    GRANT_PROGRAM ||--o{ GRANT_CYCLE : has
    ORGANIZATION_TYPE_SVT ||--o{ ORGANIZATION : types
    ORGANIZATION ||--o{ ACCOUNT : employs
    USER_ROLE_SVT ||--o{ ACCOUNT : assigns
    GRANT_CYCLE ||--o{ APPLICATION : contains
    ORGANIZATION ||--o{ APPLICATION : partners
    APPLICATION ||--o{ CANDIDATE : includes
    CANDIDATE_STATUS_SVT ||--o{ CANDIDATE : tracks
    CANDIDATE ||--o{ CANDIDATE_STATUS_CHANGE : logs
    GRANT_CYCLE ||--o{ BATCH : contains
    ORGANIZATION ||--o{ BATCH : submits
    BATCH_STATUS_SVT ||--o{ BATCH : tracks
    BATCH ||--o{ BATCH_CANDIDATE : contains
    BATCH_CANDIDATE }o--|| CANDIDATE : links
    BATCH ||--o{ BATCH_STATUS_CHANGE : logs
    BATCH_TIMELINE_EVENT_TYPE_SVT ||--o{ BATCH_TIMELINE_EVENT : types
    BATCH ||--o{ BATCH_TIMELINE_EVENT : records
    BATCH ||--|| DISBURSEMENT : triggers
    DISBURSEMENT_STATUS_SVT ||--o{ DISBURSEMENT : tracks
    DISBURSEMENT ||--o{ DISBURSEMENT_STATUS_CHANGE : logs
    DISBURSEMENT ||--o{ DISBURSEMENT_FILE : attaches
    GRANT_CYCLE ||--o{ REPORTING_PERIOD : defines
    REPORT_TYPE_SVT ||--o{ REPORTING_PERIOD : configures
    REPORTING_PERIOD ||--o{ CANDIDATE_REPORT : collects
    CANDIDATE ||--o{ CANDIDATE_REPORT : has
    ORGANIZATION ||--o{ CANDIDATE_REPORT : submits
    CANDIDATE_REPORT ||--o{ CANDIDATE_REPORT_FILE : attaches
    FILE_TYPE_SVT ||--o{ FILE : types
    DISBURSEMENT_FILE }o--|| FILE : stores
    CANDIDATE_REPORT_FILE }o--|| FILE : stores
    NOTIFICATION_TYPE_SVT ||--o{ NOTIFICATION : templates
    ACCOUNT ||--o{ NOTIFICATION : receives

    GRANT_PROGRAM {
        int Id PK
        string Code UK
        string Name
        string Description
        string WorkflowType
        string BatchStrategy
        int HoursThreshold
        int CredentialHoursThreshold
        boolean IsActive
    }

    GRANT_CYCLE {
        int Id PK
        int GrantProgramId FK
        string Name
        string FiscalYear
        decimal AppropriatedAmount
        decimal DefaultAwardAmount
        decimal MinAwardAmount
        decimal MaxAwardAmount
        datetime ApplicationOpenOn
        datetime ApplicationCloseOn
        datetime CycleStartOn
        datetime CycleEndOn
        string Status
    }

    ORGANIZATION_TYPE_SVT {
        int Id PK
        string Name
        string Description
        int DisplayOrder
    }

    ORGANIZATION {
        int Id PK
        int TypeId FK
        string EcsCdsCode UK
        int EcsOrganizationId
        string Name
        string StreetAddress
        string City
        string StateProvince
        string PostalCode
        string PrimaryEmailAddress
        string PrimaryPhoneNumber
        string EmailDomain
        boolean IsActive
        datetime LastEcsSyncOn
    }

    USER_ROLE_SVT {
        int Id PK
        string Code UK
        string Name
        string Description
        int DisplayOrder
    }

    ACCOUNT {
        int Id PK
        int OrganizationId FK
        int RoleId FK
        string EmailAddress UK
        string FirstName
        string LastName
        string PhoneNumber
        string Title
        string EntraId
        string OAuthProvider
        boolean IsActive
        datetime LastLoginOn
    }

    APPLICATION {
        int Id PK
        int GrantCycleId FK
        int IHEOrgId FK
        int LEAOrgId FK
        int InitiatorContactId FK
        int CompleterContactId FK
        string GAASignerName
        string GAASignerTitle
        string GAASignerEmail
        string FiscalAgentName
        string FiscalAgentEmail
        string FiscalAgentPhone
        string SuperintendentName
        string SuperintendentEmail
        string POCFirstName
        string POCLastName
        string POCEmail
        string POCPhone
        string PaymentIntent
        string PaymentSchedule
        string Status
    }

    CANDIDATE_STATUS_SVT {
        int Id PK
        string Code UK
        string Name
        string Description
        int DisplayOrder
        string Category
        string LEADisplayCategory
        boolean IsTerminal
        string AllowedTransitionsJson
    }

    CANDIDATE {
        int Id PK
        int ApplicationId FK
        int StatusId FK
        string SEID UK
        string FirstName
        string LastName
        datetime DateOfBirth
        string Last4SSN
        string EmailAddress
        string Race
        string Ethnicity
        string Gender
        string CredentialArea
        string SchoolCdsCode
        string SchoolName
        decimal RequestedAmount
        decimal AwardedAmount
        int WaitlistPosition
        datetime WaitlistAddedOn
        datetime StatusChangedOn
        int StatusChangedByAccountId FK
        datetime SubmittedByInitiatorOn
        datetime SubmittedByCompleterOn
        datetime SubmittedToCTCOn
        datetime ApprovedOn
        int ApprovedByAccountId FK
        datetime RejectedOn
        int RejectedByAccountId FK
        string RejectionReason
    }

    CANDIDATE_STATUS_CHANGE {
        int Id PK
        int CandidateId FK
        int FromStatusId FK
        int ToStatusId FK
        datetime ChangedOn
        int ChangedByAccountId FK
        string Comments
    }

    BATCH_STATUS_SVT {
        int Id PK
        string Code UK
        string Name
        string Description
        int DisplayOrder
        string Category
        boolean IsTerminal
        string AllowedTransitionsJson
    }

    BATCH {
        int Id PK
        int GrantCycleId FK
        int StatusId FK
        int SubmittingOrgId FK
        string BatchNumber
        string SubmissionPeriod
        string BatchType
        int CandidateCount
        decimal TotalAwardAmount
        datetime StatusChangedOn
        int StatusChangedByAccountId FK
        datetime SubmittedOn
        int SubmittedByAccountId FK
        datetime ApprovedOn
        int ApprovedByAccountId FK
        datetime RejectedOn
        int RejectedByAccountId FK
        string RejectionReason
    }

    BATCH_CANDIDATE {
        int Id PK
        int BatchId FK
        int CandidateId FK
        datetime AddedOn
        int AddedByAccountId FK
    }

    BATCH_STATUS_CHANGE {
        int Id PK
        int BatchId FK
        int FromStatusId FK
        int ToStatusId FK
        datetime ChangedOn
        int ChangedByAccountId FK
        string Comments
    }

    BATCH_TIMELINE_EVENT_TYPE_SVT {
        int Id PK
        string Code UK
        string Name
        string Description
        int DisplayOrder
    }

    BATCH_TIMELINE_EVENT {
        int Id PK
        int BatchId FK
        int EventTypeId FK
        datetime EventOn
        int EventByAccountId FK
        string Description
        string IHESource
    }

    DISBURSEMENT_STATUS_SVT {
        int Id PK
        string Code UK
        string Name
        string Description
        int DisplayOrder
    }

    DISBURSEMENT {
        int Id PK
        int BatchId FK
        int StatusId FK
        string Phase
        int Sequence
        decimal Amount
        decimal PercentOfTotal
        string GAADocumentStorageKey
        string GAAEnvelopeId
        string GAAStatus
        datetime GAASentOn
        datetime GAASignedOn
        datetime GAACompletedOn
        string PONumber
        decimal POAmount
        datetime POIssuedOn
        string PODocumentStorageKey
        datetime POUploadedOn
        int POUploadedByAccountId FK
        string InvoiceNumber
        decimal InvoiceAmount
        datetime InvoiceIssuedOn
        string InvoiceDocumentStorageKey
        datetime InvoiceSentOn
        string WarrantNumber
        decimal WarrantAmount
        datetime WarrantIssuedOn
        datetime WarrantConfirmedOn
        int WarrantConfirmedByAccountId FK
    }

    DISBURSEMENT_STATUS_CHANGE {
        int Id PK
        int DisbursementId FK
        int FromStatusId FK
        int ToStatusId FK
        datetime ChangedOn
        int ChangedByAccountId FK
        string Comments
    }

    DISBURSEMENT_FILE {
        int Id PK
        int DisbursementId FK
        int FileId FK
        string Purpose
    }

    REPORT_TYPE_SVT {
        int Id PK
        string Code UK
        string Name
        string Description
        int DisplayOrder
        int ReportingOrgTypeId FK
        string FormSchemaJson
    }

    REPORTING_PERIOD {
        int Id PK
        int GrantCycleId FK
        int ReportTypeId FK
        string PeriodName
        datetime StartOn
        datetime DueOn
        boolean IsActive
    }

    CANDIDATE_REPORT {
        int Id PK
        int CandidateId FK
        int ReportingPeriodId FK
        int ReportingOrgId FK
        int ReportTypeId FK
        int ReportingOrgTypeId FK
        string CompletionStatus
        datetime CompletionOn
        int GrantProgramHours
        int CredentialProgramHours
        boolean HasCredentialEarned
        datetime CredentialEarnedOn
        string EmploymentStatus
        boolean IsHiredByPartnerOrg
        boolean IsEmployedInDistrict
        boolean IsEmployedInState
        string PaymentCategory
        decimal PaymentAmount
        datetime PaymentOn
        string Status
        datetime SubmittedOn
        int SubmittedByAccountId FK
        datetime ApprovedOn
        int ApprovedByAccountId FK
        string RevisionNotes
    }

    CANDIDATE_REPORT_FILE {
        int Id PK
        int CandidateReportId FK
        int FileId FK
    }

    FILE_TYPE_SVT {
        int Id PK
        string Name
        string Description
        int DisplayOrder
    }

    FILE {
        int Id PK
        int TypeId FK
        datetime DocumentDate
        string Title
        string StorageKey UK
        string FileName
        int FileSizeInKilobytes
        string FormatDescription
        string RelativePath
        string ContentHash
    }

    NOTIFICATION_TYPE_SVT {
        int Id PK
        string Code UK
        string Name
        string Description
        int DisplayOrder
        string SubjectTemplate
        string BodyTemplate
    }

    NOTIFICATION {
        int Id PK
        int TypeId FK
        int RecipientAccountId FK
        int RelatedBatchId FK
        int RelatedCandidateId FK
        int RelatedApplicationId FK
        string RecipientEmailAddress
        string Subject
        string BodyHtml
        string Status
        datetime SentOn
        string ErrorMessage
        int RetryCount
    }

    AUDIT_LOG {
        bigint Id PK
        string EntityType
        int EntityId
        string Action
        string OldValueJson
        string NewValueJson
        int AccountId FK
        string IpAddress
        string UserAgent
        datetime CreatedOn
    }
