erDiagram

    GRANT_PROGRAM ||--o{ GRANT_CYCLE : has
    ORGANIZATION_TYPE_SVT ||--o{ ORGANIZATION : types
    ORGANIZATION ||--o{ ACCOUNT : employs
    USER_ROLE_SVT ||--o{ ACCOUNT : assigns
    GRANT_CYCLE ||--o{ CANDIDATE : enrolls
    ORGANIZATION ||--o{ CANDIDATE : enters
    CANDIDATE_STATUS_SVT ||--o{ CANDIDATE : tracks
    CANDIDATE ||--o{ CANDIDATE_STATUS_CHANGE : logs
    GRANT_CYCLE ||--o{ SUBMISSION : contains
    ORGANIZATION ||--o{ SUBMISSION : submits
    SUBMISSION_STATUS_SVT ||--o{ SUBMISSION : tracks
    SUBMISSION ||--o{ SUBMISSION_CANDIDATE : contains
    SUBMISSION_CANDIDATE }o--|| CANDIDATE : links
    SUBMISSION ||--o{ SUBMISSION_STATUS_CHANGE : logs
    SUBMISSION_TIMELINE_EVENT_TYPE_SVT ||--o{ SUBMISSION_TIMELINE_EVENT : types
    SUBMISSION ||--o{ SUBMISSION_TIMELINE_EVENT : records
    CANDIDATE ||--o{ DISBURSEMENT : receives
    SUBMISSION ||--o{ DISBURSEMENT : batches
    DISBURSEMENT_STATUS_SVT ||--o{ DISBURSEMENT : tracks
    DISBURSEMENT ||--o{ DISBURSEMENT_STATUS_CHANGE : logs
    DISBURSEMENT ||--o{ DISBURSEMENT_FILE : attaches
    GRANT_CYCLE ||--o{ REPORTING_PERIOD : defines
    REPORT_TYPE_SVT ||--o{ REPORTING_PERIOD : configures
    REPORTING_PERIOD ||--o{ CANDIDATE_REPORT : collects
    CANDIDATE ||--o{ CANDIDATE_REPORT : has
    ORGANIZATION ||--o{ CANDIDATE_REPORT : submits
    CANDIDATE_REPORT ||--o{ CANDIDATE_REPORT_FILE : attaches
    FILE_TYPE_SVT ||--o{ FILE : types
    DISBURSEMENT_FILE }o--|| FILE : stores
    CANDIDATE_REPORT_FILE }o--|| FILE : stores
    NOTIFICATION_TYPE_SVT ||--o{ NOTIFICATION : templates
    ACCOUNT ||--o{ NOTIFICATION : receives

    GRANT_PROGRAM {
        int Id PK
        varchar(50) Code UK
        varchar(100) Name
        varchar(500) Description
        varchar(50) WorkflowType
        varchar(50) BatchStrategy
        int HoursThreshold
        int CredentialHoursThreshold
        varchar(max) EligibleCredentialAreasJson
        varchar(max) RequiredDocumentsJson
        bit IsActive
    }

    GRANT_CYCLE {
        int Id PK
        int GrantProgramId FK
        varchar(100) Name
        varchar(10) FiscalYear
        decimal AppropriatedAmount
        decimal EncumberedAmount
        decimal DisbursedAmount
        decimal DefaultAwardAmount
        decimal MinAwardAmount
        decimal MaxAwardAmount
        datetime ApplicationOpenOn
        datetime ApplicationCloseOn
        datetime CycleStartOn
        datetime CycleEndOn
        varchar(50) Status
    }

    ORGANIZATION_TYPE_SVT {
        int Id PK
        varchar(50) Code UK
        varchar(100) Name
        varchar(500) Description
        int DisplayOrder
    }

    ORGANIZATION {
        int Id PK
        int TypeId FK
        varchar(20) EcsCdsCode UK
        int EcsOrganizationId
        varchar(100) Name
        varchar(255) StreetAddress
        varchar(100) City
        varchar(50) StateProvince
        varchar(20) PostalCode
        varchar(255) PrimaryEmailAddress
        varchar(25) PrimaryPhoneNumber
        varchar(100) EmailDomain
        bit IsActive
        datetime LastEcsSyncOn
    }

    USER_ROLE_SVT {
        int Id PK
        varchar(50) Code UK
        varchar(100) Name
        varchar(500) Description
        int DisplayOrder
    }

    ACCOUNT {
        int Id PK
        int OrganizationId FK
        int UserRoleSVTId FK
        varchar(255) EmailAddress UK
        varchar(100) FirstName
        varchar(100) LastName
        varchar(25) PhoneNumber
        varchar(100) Title
        varchar(100) EntraId
        varchar(50) OAuthProvider
        bit IsActive
        datetime LastLoginOn
    }

    CANDIDATE_STATUS_SVT {
        int Id PK
        varchar(50) Code UK
        varchar(100) Name
        varchar(500) Description
        int DisplayOrder
        varchar(50) Category
        varchar(50) LEADisplayCategory
        bit IsTerminal
        varchar(max) AllowedTransitionsJson
    }

    CANDIDATE {
        int Id PK
        int GrantCycleId FK
        int OriginatingOrgId FK
        int StatusId FK
        varchar(20) SEID UK
        varchar(100) FirstName
        varchar(100) LastName
        datetime DateOfBirth
        varchar(4) Last4SSN
        varchar(255) EmailAddress
        varchar(50) Race
        varchar(50) Ethnicity
        varchar(20) Gender
        varchar(100) CredentialArea
        varchar(20) SchoolCdsCode
        varchar(100) SchoolName
        decimal RequestedAmount
        decimal AwardedAmount
        int WaitlistPosition
        datetime WaitlistAddedOn
        datetime StatusChangedOn
        int StatusChangedByAccountId FK
        datetime SubmittedByInitiatorOn
        datetime SubmittedByCompleterOn
        datetime SubmittedToCTCOn
        datetime ApprovedOn
        int ApprovedByAccountId FK
        datetime RejectedOn
        int RejectedByAccountId FK
        varchar(max) RejectionReason
    }

    CANDIDATE_STATUS_CHANGE {
        int Id PK
        int CandidateId FK
        int FromStatusId FK
        int ToStatusId FK
        datetime ChangedOn
        int ChangedByAccountId FK
        varchar(max) Comments
    }

    SUBMISSION_STATUS_SVT {
        int Id PK
        varchar(50) Code UK
        varchar(100) Name
        varchar(500) Description
        int DisplayOrder
        varchar(50) Category
        bit IsTerminal
        varchar(max) AllowedTransitionsJson
    }

    SUBMISSION {
        int Id PK
        int GrantCycleId FK
        int StatusId FK
        int SubmittingOrgId FK
        varchar(50) SubmissionNumber
        varchar(20) SubmissionPeriod
        varchar(50) SubmissionType
        int CandidateCount
        decimal TotalAwardAmount
        datetime StatusChangedOn
        int StatusChangedByAccountId FK
        datetime SubmittedOn
        int SubmittedByAccountId FK
        datetime ApprovedOn
        int ApprovedByAccountId FK
        datetime RejectedOn
        int RejectedByAccountId FK
        varchar(max) RejectionReason
    }

    SUBMISSION_CANDIDATE {
        int Id PK
        int SubmissionId FK
        int CandidateId FK
        datetime AddedOn
        int AddedByAccountId FK
    }

    SUBMISSION_STATUS_CHANGE {
        int Id PK
        int SubmissionId FK
        int FromStatusId FK
        int ToStatusId FK
        datetime ChangedOn
        int ChangedByAccountId FK
        varchar(max) Comments
    }

    SUBMISSION_TIMELINE_EVENT_TYPE_SVT {
        int Id PK
        varchar(50) Code UK
        varchar(100) Name
        varchar(500) Description
        int DisplayOrder
    }

    SUBMISSION_TIMELINE_EVENT {
        int Id PK
        int SubmissionId FK
        int EventTypeId FK
        datetime EventOn
        int EventByAccountId FK
        varchar(500) Description
        varchar(100) IHESource
    }

    DISBURSEMENT_STATUS_SVT {
        int Id PK
        varchar(50) Code UK
        varchar(100) Name
        varchar(500) Description
        int DisplayOrder
    }

    DISBURSEMENT {
        int Id PK
        int CandidateId FK
        int SubmissionId FK
        int StatusId FK
        varchar(50) Phase
        int Sequence
        decimal Amount
        decimal PercentOfTotal
        varchar(500) GAADocumentStorageKey
        varchar(100) GAAEnvelopeId
        varchar(50) GAAStatus
        datetime GAASentOn
        datetime GAASignedOn
        datetime GAACompletedOn
        varchar(50) PONumber
        decimal POAmount
        datetime POIssuedOn
        varchar(500) PODocumentStorageKey
        datetime POUploadedOn
        int POUploadedByAccountId FK
        varchar(50) InvoiceNumber
        decimal InvoiceAmount
        datetime InvoiceIssuedOn
        varchar(500) InvoiceDocumentStorageKey
        datetime InvoiceSentOn
        varchar(50) WarrantNumber
        decimal WarrantAmount
        datetime WarrantIssuedOn
        datetime WarrantConfirmedOn
        int WarrantConfirmedByAccountId FK
    }

    DISBURSEMENT_STATUS_CHANGE {
        int Id PK
        int DisbursementId FK
        int FromStatusId FK
        int ToStatusId FK
        datetime ChangedOn
        int ChangedByAccountId FK
        varchar(max) Comments
    }

    DISBURSEMENT_FILE {
        int Id PK
        int DisbursementId FK
        int FileId FK
        varchar(100) Purpose
    }

    REPORT_TYPE_SVT {
        int Id PK
        varchar(50) Code UK
        varchar(100) Name
        varchar(500) Description
        int DisplayOrder
        int ReportingOrgTypeSVTId FK
        varchar(max) FormSchemaJson
    }

    REPORTING_PERIOD {
        int Id PK
        int GrantCycleId FK
        int ReportTypeId FK
        varchar(100) PeriodName
        datetime StartOn
        datetime DueOn
        bit IsActive
    }

    CANDIDATE_REPORT {
        int Id PK
        int CandidateId FK
        int ReportingPeriodId FK
        int ReportingOrgId FK
        int ReportTypeId FK
        int ReportingOrgTypeSVTId FK
        varchar(50) CompletionStatus
        datetime CompletionOn
        varchar(max) DenialReason
        bit SwitchedToIntern
        datetime InternSwitchOn
        int GrantProgramHours
        int CredentialProgramHours
        bit HasCredentialEarned
        datetime CredentialEarnedOn
        varchar(100) CredentialType
        varchar(50) CredentialEarnedStatus
        varchar(50) ProgramCompletionStatus
        datetime ProgramCompletionOn
        varchar(50) EmploymentStatus
        bit IsHiredByPartnerOrg
        bit IsEmployedInDistrict
        bit IsEmployedInState
        varchar(100) EmployerName
        datetime HireOn
        datetime EmploymentStartOn
        varchar(100) JobTitle
        varchar(100) SchoolSite
        varchar(50) GradeLevel
        varchar(100) SubjectArea
        varchar(50) PaymentCategory
        varchar(50) PaymentSchedule
        decimal PaymentAmount
        datetime PaymentOn
        datetime FirstPaymentOn
        datetime FinalPaymentOn
        varchar(max) PaymentScheduleDetails
        int PlacementQualityRating
        varchar(max) PlacementQualityNotes
        varchar(100) MentorTeacherName
        varchar(max) MentorTeacherFeedback
        varchar(50) Status
        datetime SubmittedOn
        int SubmittedByAccountId FK
        datetime ApprovedOn
        int ApprovedByAccountId FK
        varchar(max) RevisionNotes
        int RevisionCount
        varchar(100) ConfirmationNumber
        bit IsLocked
        datetime LockedOn
        int LockedByAccountId FK
        varchar(100) CTCReviewer
        datetime CTCReviewOn
        varchar(max) CTCFeedback
    }

    CANDIDATE_REPORT_FILE {
        int Id PK
        int CandidateReportId FK
        int FileId FK
    }

    FILE_TYPE_SVT {
        int Id PK
        varchar(50) Code UK
        varchar(100) Name
        varchar(500) Description
        int DisplayOrder
    }

    FILE {
        int Id PK
        int TypeId FK
        datetime DocumentDate
        varchar(255) Title
        varchar(500) StorageKey UK
        varchar(255) FileName
        int FileSizeInKilobytes
        varchar(100) FormatDescription
        varchar(500) RelativePath
        varchar(64) ContentHash
    }

    NOTIFICATION_TYPE_SVT {
        int Id PK
        varchar(50) Code UK
        varchar(100) Name
        varchar(500) Description
        int DisplayOrder
        varchar(500) SubjectTemplate
        varchar(max) BodyTemplate
    }

    NOTIFICATION {
        int Id PK
        int TypeId FK
        int RecipientAccountId FK
        int RelatedSubmissionId FK
        int RelatedCandidateId FK
        int RelatedDisbursementId FK
        varchar(255) RecipientEmailAddress
        varchar(500) Subject
        varchar(max) BodyHtml
        varchar(50) Status
        datetime SentOn
        varchar(max) ErrorMessage
        int RetryCount
    }

    AUDIT_LOG {
        bigint Id PK
        varchar(100) EntityType
        int EntityId
        varchar(50) Action
        varchar(max) OldValueJson
        varchar(max) NewValueJson
        int AccountId FK
        varchar(45) IpAddress
        varchar(500) UserAgent
        datetime CreatedOn
        int CreatedByAccountId
        datetime LastUpdatedOn
        int LastUpdatedByAccountId
        bit CanBeDeleted
    }
