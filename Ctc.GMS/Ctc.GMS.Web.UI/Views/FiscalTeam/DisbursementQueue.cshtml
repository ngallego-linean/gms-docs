@{
    ViewData["Title"] = "Disbursement Queue";

    // MOCK DATA: Same as Dashboard Disbursement Processing table
    // States: NEEDS_GAA, NEEDS_PO, NEEDS_INVOICE, NEEDS_WARRANT, COMPLETE
    var allDisbursementGroups = new List<dynamic>
    {
        new { SubmissionDate = DateTime.Now.AddDays(-5), LEA = "Fresno Unified School District", LastAction = "Approved", LastActionDate = DateTime.Now.AddDays(-1), Amount = 67500m, State = "NEEDS_GAA", Id = 1,
            Step1Date = (DateTime?)null, Step2Date = (DateTime?)null, Step3Date = (DateTime?)null, Step4Date = (DateTime?)null, Step5Date = (DateTime?)null, Step6Date = (DateTime?)null },
        new { SubmissionDate = DateTime.Now.AddDays(-7), LEA = "Sacramento City Unified School District", LastAction = "GAA Signed", LastActionDate = DateTime.Now.AddDays(-2), Amount = 48000m, State = "NEEDS_PO", Id = 2,
            Step1Date = DateTime.Now.AddDays(-2), Step2Date = (DateTime?)null, Step3Date = (DateTime?)null, Step4Date = (DateTime?)null, Step5Date = (DateTime?)null, Step6Date = (DateTime?)null },
        new { SubmissionDate = DateTime.Now.AddDays(-10), LEA = "Oakland Unified School District", LastAction = "PO Uploaded", LastActionDate = DateTime.Now.AddDays(-3), Amount = 42000m, State = "NEEDS_INVOICE", Id = 3,
            Step1Date = DateTime.Now.AddDays(-8), Step2Date = DateTime.Now.AddDays(-3), Step3Date = (DateTime?)null, Step4Date = (DateTime?)null, Step5Date = (DateTime?)null, Step6Date = (DateTime?)null },
        new { SubmissionDate = DateTime.Now.AddDays(-15), LEA = "Los Angeles Unified School District", LastAction = "Invoice Sent", LastActionDate = DateTime.Now.AddDays(-2), Amount = 125000m, State = "NEEDS_WARRANT", Id = 4,
            Step1Date = DateTime.Now.AddDays(-12), Step2Date = DateTime.Now.AddDays(-8), Step3Date = DateTime.Now.AddDays(-5), Step4Date = DateTime.Now.AddDays(-2), Step5Date = (DateTime?)null, Step6Date = (DateTime?)null },
        new { SubmissionDate = DateTime.Now.AddDays(-20), LEA = "San Diego Unified School District", LastAction = "Warrant Confirmed", LastActionDate = DateTime.Now.AddDays(-1), Amount = 87500m, State = "COMPLETE", Id = 5,
            Step1Date = DateTime.Now.AddDays(-18), Step2Date = DateTime.Now.AddDays(-14), Step3Date = DateTime.Now.AddDays(-10), Step4Date = DateTime.Now.AddDays(-5), Step5Date = DateTime.Now.AddDays(-2), Step6Date = DateTime.Now.AddDays(-1) },
        new { SubmissionDate = DateTime.Now.AddDays(-25), LEA = "Long Beach Unified School District", LastAction = "Approved", LastActionDate = DateTime.Now.AddDays(-1), Amount = 52500m, State = "NEEDS_GAA", Id = 6,
            Step1Date = (DateTime?)null, Step2Date = (DateTime?)null, Step3Date = (DateTime?)null, Step4Date = (DateTime?)null, Step5Date = (DateTime?)null, Step6Date = (DateTime?)null },
        new { SubmissionDate = DateTime.Now.AddDays(-30), LEA = "Riverside Unified School District", LastAction = "Warrant Confirmed", LastActionDate = DateTime.Now.AddDays(-5), Amount = 95000m, State = "COMPLETE", Id = 7,
            Step1Date = DateTime.Now.AddDays(-28), Step2Date = DateTime.Now.AddDays(-24), Step3Date = DateTime.Now.AddDays(-20), Step4Date = DateTime.Now.AddDays(-15), Step5Date = DateTime.Now.AddDays(-10), Step6Date = DateTime.Now.AddDays(-5) }
    };

    // Split into pending and completed
    var pendingGroups = allDisbursementGroups
        .Where(g => g.State != "COMPLETE")
        .OrderBy(g => g.SubmissionDate)
        .ToList();

    var completedGroups = allDisbursementGroups
        .Where(g => g.State == "COMPLETE")
        .OrderByDescending(g => g.Step6Date)
        .ToList();

    // Workflow step definitions (6 stages)
    var workflowSteps = new[] {
        new { Step = 1, Name = "GAA Signed", FullName = "GAA Signed", Icon = "mdi-file-sign" },
        new { Step = 2, Name = "PO Generated", FullName = "PO Generated", Icon = "mdi-file-document-outline" },
        new { Step = 3, Name = "PO Uploaded", FullName = "PO Uploaded", Icon = "mdi-cloud-upload-outline" },
        new { Step = 4, Name = "Invoice", FullName = "Invoice Generated", Icon = "mdi-receipt-text-outline" },
        new { Step = 5, Name = "Sent", FullName = "Invoice Sent to Accounting", Icon = "mdi-send-outline" },
        new { Step = 6, Name = "Warrant", FullName = "Warrant Confirmed", Icon = "mdi-check-decagram" }
    };

    var pendingCount = pendingGroups.Count;
    var totalPendingAmount = pendingGroups.Sum(g => (decimal)g.Amount);
    var completedCount = completedGroups.Count;
    var totalCompletedAmount = completedGroups.Sum(g => (decimal)g.Amount);
}

@section Breadcrumbs {
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "GrantsTeam")">Grants Team</a></li>
        <li class="breadcrumb-item active">Disbursement Queue</li>
    </ol>
}

<div class="page-header">
    <h2><i class="mdi mdi-clipboard-list-outline"></i> Disbursement Queue</h2>
    <p class="subtitle">Student Teacher Stipend Program - All Disbursement Groups</p>
</div>

<div class="page-actions">
    <button type="button" class="r4-button r4-button-secondary" onclick="history.back()">
        <i class="mdi mdi-arrow-left"></i> Back
    </button>
</div>

@* Pending Disbursements Section *@
@if (pendingGroups.Any())
{
    <div class="alert alert-warning">
        <i class="mdi mdi-alert-outline"></i>
        <strong>@pendingCount disbursement group(s)</strong> totaling <strong>@totalPendingAmount.ToString("C0")</strong> are in the processing pipeline.
    </div>

    <div class="r4-card">
        <div class="r4-card-header">
            <h4><i class="mdi mdi-folder-open-outline"></i> Pending Disbursements</h4>
        </div>
        <div class="r4-card-body">
            <table class="r4-table disbursement-table" id="pendingTable">
                <thead>
                    <tr>
                        <th style="width: 30px;"></th>
                        <th>Submission Date</th>
                        <th>LEA District</th>
                        <th>Last Action</th>
                        <th>Total Amount</th>
                        <th>Documents</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var group in pendingGroups)
                    {
                        <tr class="disbursement-row" data-group-id="@group.Id" onclick="toggleTimelineRow(@group.Id)">
                            <td>
                                <i class="mdi mdi-chevron-right expand-icon"></i>
                            </td>
                            <td>@group.SubmissionDate.ToString("MM/dd/yyyy")</td>
                            <td>@group.LEA</td>
                            <td>
                                @group.LastAction: @group.LastActionDate.ToString("MM/dd/yyyy")
                            </td>
                            <td>@group.Amount.ToString("C0")</td>
                            <td onclick="event.stopPropagation();">
                                <a href="@Url.Action("ViewDocuments", "FiscalTeam", new { id = group.Id })" class="r4-button r4-button-sm">
                                    <i class="mdi mdi-folder-open-outline"></i> View Docs
                                </a>
                            </td>
                            <td onclick="event.stopPropagation();">
                                @if (group.State == "NEEDS_GAA")
                                {
                                    <a href="@Url.Action("GAAPreview", "FiscalTeam", new { groupId = group.Id })" class="r4-button r4-button-sm r4-button-primary">
                                        <i class="mdi mdi-file-sign"></i> Generate GAA
                                    </a>
                                }
                                else if (group.State == "NEEDS_PO")
                                {
                                    <a href="@Url.Action("UploadPO", "FiscalTeam", new { id = group.Id })" class="r4-button r4-button-sm r4-button-primary">
                                        <i class="mdi mdi-cloud-upload-outline"></i> Upload PO
                                    </a>
                                }
                                else if (group.State == "NEEDS_INVOICE")
                                {
                                    <a href="@Url.Action("DownloadInvoice", "FiscalTeam", new { id = group.Id })" class="r4-button r4-button-sm r4-button-primary">
                                        <i class="mdi mdi-receipt-text-outline"></i> Generate Invoice
                                    </a>
                                }
                                else if (group.State == "NEEDS_WARRANT")
                                {
                                    <a href="@Url.Action("UploadWarrant", "FiscalTeam", new { id = group.Id })" class="r4-button r4-button-sm r4-button-primary">
                                        <i class="mdi mdi-check-decagram"></i> Upload Warrant
                                    </a>
                                }
                            </td>
                        </tr>
                        @* Timeline Sub-Row *@
                        <tr id="timeline-@group.Id" class="timeline-sub-row collapse">
                            <td colspan="7">
                                <div class="timeline-container">
                                    <div class="horizontal-timeline">
                                        @{
                                            var stepDates = new DateTime?[] {
                                                group.Step1Date, group.Step2Date, group.Step3Date,
                                                group.Step4Date, group.Step5Date, group.Step6Date
                                            };
                                        }
                                        @foreach (var step in workflowSteps)
                                        {
                                            var stepDate = stepDates[step.Step - 1];
                                            var isCompleted = stepDate.HasValue;
                                            var isCurrent = !isCompleted && stepDates.Take(step.Step - 1).All(d => d.HasValue);
                                            var markerClass = isCompleted ? "timeline-marker-success" :
                                                              isCurrent ? "timeline-marker-primary" : "";
                                            var iconClass = isCompleted ? "mdi-check" : step.Icon;

                                            <div class="timeline-step @(isCompleted ? "completed" : "") @(isCurrent ? "current" : "")">
                                                <div class="timeline-step-marker @markerClass">
                                                    <i class="mdi @iconClass"></i>
                                                </div>
                                                <div class="timeline-step-content">
                                                    <div class="timeline-step-title">@step.Name</div>
                                                    <div class="timeline-step-date">
                                                        @if (isCompleted)
                                                        {
                                                            @stepDate.Value.ToString("MM/dd/yy")
                                                        }
                                                        else if (isCurrent)
                                                        {
                                                            <span class="current-step-label">In Progress</span>
                                                        }
                                                        else
                                                        {
                                                            <span class="pending-label">Pending</span>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            @* Pagination Controls *@
            <div class="pagination-controls" id="pendingPagination" style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--gray-200);">
                <div class="pagination-info">
                    Showing <span id="pendingShowingStart">1</span>-<span id="pendingShowingEnd">@Math.Min(10, pendingGroups.Count)</span> of <span id="pendingTotalRecords">@pendingGroups.Count</span> groups
                </div>
                <div class="pagination-buttons" style="display: flex; gap: 0.5rem; align-items: center;">
                    <button type="button" class="r4-button r4-button-sm" id="pendingPrevPage" onclick="changePendingPage(-1)">
                        <i class="mdi mdi-chevron-left"></i> Previous
                    </button>
                    <span style="padding: 0 0.75rem;">Page <span id="pendingCurrentPage">1</span> of <span id="pendingTotalPages">@Math.Max(1, (int)Math.Ceiling(pendingGroups.Count / 10.0))</span></span>
                    <button type="button" class="r4-button r4-button-sm" id="pendingNextPage" onclick="changePendingPage(1)">
                        Next <i class="mdi mdi-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="alert alert-info">
        <i class="mdi mdi-information-outline"></i>
        No disbursement groups are currently pending. All disbursements have been processed.
    </div>
}

@* Completed Disbursements Section *@
@if (completedGroups.Any())
{
    <div class="r4-card" style="margin-top: 1.5rem;">
        <div class="r4-card-header">
            <h4><i class="mdi mdi-check-circle-outline"></i> Completed Disbursements</h4>
        </div>
        <div class="r4-card-body">
            <table class="r4-table disbursement-table" id="completedTable">
                <thead>
                    <tr>
                        <th style="width: 30px;"></th>
                        <th>Submission Date</th>
                        <th>LEA District</th>
                        <th>Completed</th>
                        <th>Total Amount</th>
                        <th>Documents</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var group in completedGroups)
                    {
                        <tr class="disbursement-row" data-group-id="@group.Id" onclick="toggleTimelineRow(@group.Id)">
                            <td>
                                <i class="mdi mdi-chevron-right expand-icon"></i>
                            </td>
                            <td>@group.SubmissionDate.ToString("MM/dd/yyyy")</td>
                            <td>@group.LEA</td>
                            <td>@(((DateTime?)group.Step6Date).Value.ToString("MM/dd/yyyy"))</td>
                            <td>@group.Amount.ToString("C0")</td>
                            <td onclick="event.stopPropagation();">
                                <a href="@Url.Action("ViewDocuments", "FiscalTeam", new { id = group.Id })" class="r4-button r4-button-sm">
                                    <i class="mdi mdi-folder-open-outline"></i> View Docs
                                </a>
                            </td>
                            <td>
                                <span class="r4-button r4-button-sm r4-button-success"><i class="mdi mdi-check-circle"></i> Complete</span>
                            </td>
                        </tr>
                        @* Timeline Sub-Row *@
                        <tr id="timeline-@group.Id" class="timeline-sub-row collapse">
                            <td colspan="7">
                                <div class="timeline-container">
                                    <div class="horizontal-timeline">
                                        @{
                                            var stepDates = new DateTime?[] {
                                                group.Step1Date, group.Step2Date, group.Step3Date,
                                                group.Step4Date, group.Step5Date, group.Step6Date
                                            };
                                        }
                                        @foreach (var step in workflowSteps)
                                        {
                                            var stepDate = stepDates[step.Step - 1];
                                            var isCompleted = stepDate.HasValue;

                                            <div class="timeline-step completed">
                                                <div class="timeline-step-marker timeline-marker-success">
                                                    <i class="mdi mdi-check"></i>
                                                </div>
                                                <div class="timeline-step-content">
                                                    <div class="timeline-step-title">@step.Name</div>
                                                    <div class="timeline-step-date">
                                                        @if (isCompleted)
                                                        {
                                                            @stepDate.Value.ToString("MM/dd/yy")
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            @* Pagination Controls *@
            <div class="pagination-controls" id="completedPagination" style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--gray-200);">
                <div class="pagination-info">
                    Showing <span id="completedShowingStart">1</span>-<span id="completedShowingEnd">@Math.Min(10, completedGroups.Count)</span> of <span id="completedTotalRecords">@completedGroups.Count</span> disbursements
                </div>
                <div class="pagination-buttons" style="display: flex; gap: 0.5rem; align-items: center;">
                    <button type="button" class="r4-button r4-button-sm" id="completedPrevPage" onclick="changeCompletedPage(-1)">
                        <i class="mdi mdi-chevron-left"></i> Previous
                    </button>
                    <span style="padding: 0 0.75rem;">Page <span id="completedCurrentPage">1</span> of <span id="completedTotalPages">@Math.Max(1, (int)Math.Ceiling(completedGroups.Count / 10.0))</span></span>
                    <button type="button" class="r4-button r4-button-sm" id="completedNextPage" onclick="changeCompletedPage(1)">
                        Next <i class="mdi mdi-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
}

@section Scripts {
    <script>
        const ROWS_PER_PAGE = 10;

        // Pending table pagination
        let pendingCurrentPage = 1;
        let pendingMainRows = [];

        // Completed table pagination
        let completedCurrentPage = 1;
        let completedMainRows = [];

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize pending table pagination
            const pendingTable = document.getElementById('pendingTable');
            if (pendingTable) {
                const pendingTbody = pendingTable.getElementsByTagName('tbody')[0];
                if (pendingTbody) {
                    // Get only main rows (not timeline sub-rows)
                    pendingMainRows = Array.from(pendingTbody.querySelectorAll('tr.disbursement-row'));
                    if (pendingMainRows.length > ROWS_PER_PAGE) {
                        updatePendingPagination();
                        showPendingPage(1);
                    }
                }
            }

            // Initialize completed table pagination
            const completedTable = document.getElementById('completedTable');
            if (completedTable) {
                const completedTbody = completedTable.getElementsByTagName('tbody')[0];
                if (completedTbody) {
                    // Get only main rows (not timeline sub-rows)
                    completedMainRows = Array.from(completedTbody.querySelectorAll('tr.disbursement-row'));
                    if (completedMainRows.length > ROWS_PER_PAGE) {
                        updateCompletedPagination();
                        showCompletedPage(1);
                    }
                }
            }
        });

        // Pending table functions
        function updatePendingPagination() {
            const totalPages = Math.ceil(pendingMainRows.length / ROWS_PER_PAGE) || 1;
            document.getElementById('pendingTotalPages').textContent = totalPages;
            document.getElementById('pendingTotalRecords').textContent = pendingMainRows.length;
            document.getElementById('pendingPrevPage').disabled = pendingCurrentPage <= 1;
            document.getElementById('pendingNextPage').disabled = pendingCurrentPage >= totalPages;
        }

        function showPendingPage(page) {
            pendingCurrentPage = page;
            const startIndex = (page - 1) * ROWS_PER_PAGE;
            const endIndex = startIndex + ROWS_PER_PAGE;

            pendingMainRows.forEach((row, index) => {
                const groupId = row.getAttribute('data-group-id');
                const timelineRow = document.getElementById('timeline-' + groupId);
                const isVisible = (index >= startIndex && index < endIndex);

                row.style.display = isVisible ? '' : 'none';
                if (timelineRow) {
                    // Hide timeline row when paginating, user can expand again
                    timelineRow.classList.remove('show');
                    timelineRow.style.display = isVisible ? '' : 'none';
                    row.classList.remove('expanded');
                    const icon = row.querySelector('.expand-icon');
                    if (icon) {
                        icon.classList.remove('mdi-chevron-down');
                        icon.classList.add('mdi-chevron-right');
                    }
                }
            });

            document.getElementById('pendingCurrentPage').textContent = page;
            document.getElementById('pendingShowingStart').textContent = pendingMainRows.length > 0 ? startIndex + 1 : 0;
            document.getElementById('pendingShowingEnd').textContent = Math.min(endIndex, pendingMainRows.length);
            updatePendingPagination();
        }

        function changePendingPage(delta) {
            const totalPages = Math.ceil(pendingMainRows.length / ROWS_PER_PAGE) || 1;
            const newPage = pendingCurrentPage + delta;
            if (newPage >= 1 && newPage <= totalPages) {
                showPendingPage(newPage);
            }
        }

        // Completed table functions
        function updateCompletedPagination() {
            const totalPages = Math.ceil(completedMainRows.length / ROWS_PER_PAGE) || 1;
            document.getElementById('completedTotalPages').textContent = totalPages;
            document.getElementById('completedTotalRecords').textContent = completedMainRows.length;
            document.getElementById('completedPrevPage').disabled = completedCurrentPage <= 1;
            document.getElementById('completedNextPage').disabled = completedCurrentPage >= totalPages;
        }

        function showCompletedPage(page) {
            completedCurrentPage = page;
            const startIndex = (page - 1) * ROWS_PER_PAGE;
            const endIndex = startIndex + ROWS_PER_PAGE;

            completedMainRows.forEach((row, index) => {
                const groupId = row.getAttribute('data-group-id');
                const timelineRow = document.getElementById('timeline-' + groupId);
                const isVisible = (index >= startIndex && index < endIndex);

                row.style.display = isVisible ? '' : 'none';
                if (timelineRow) {
                    // Hide timeline row when paginating, user can expand again
                    timelineRow.classList.remove('show');
                    timelineRow.style.display = isVisible ? '' : 'none';
                    row.classList.remove('expanded');
                    const icon = row.querySelector('.expand-icon');
                    if (icon) {
                        icon.classList.remove('mdi-chevron-down');
                        icon.classList.add('mdi-chevron-right');
                    }
                }
            });

            document.getElementById('completedCurrentPage').textContent = page;
            document.getElementById('completedShowingStart').textContent = completedMainRows.length > 0 ? startIndex + 1 : 0;
            document.getElementById('completedShowingEnd').textContent = Math.min(endIndex, completedMainRows.length);
            updateCompletedPagination();
        }

        function changeCompletedPage(delta) {
            const totalPages = Math.ceil(completedMainRows.length / ROWS_PER_PAGE) || 1;
            const newPage = completedCurrentPage + delta;
            if (newPage >= 1 && newPage <= totalPages) {
                showCompletedPage(newPage);
            }
        }

        function toggleTimelineRow(groupId) {
            const timelineRow = document.getElementById('timeline-' + groupId);
            const mainRow = document.querySelector(`tr[data-group-id="${groupId}"]`);
            const icon = mainRow.querySelector('.expand-icon');

            if (timelineRow.classList.contains('show')) {
                timelineRow.classList.remove('show');
                mainRow.classList.remove('expanded');
                icon.classList.remove('mdi-chevron-down');
                icon.classList.add('mdi-chevron-right');
            } else {
                timelineRow.classList.add('show');
                mainRow.classList.add('expanded');
                icon.classList.remove('mdi-chevron-right');
                icon.classList.add('mdi-chevron-down');
            }
        }
    </script>

    <style>
        /* Back button fix */
        .page-actions .r4-button-secondary {
            background-color: var(--gray-100) !important;
            color: var(--gray-700) !important;
            border: 1px solid var(--gray-300) !important;
        }

        .page-actions .r4-button-secondary:hover {
            background-color: var(--gray-200) !important;
            color: var(--gray-800) !important;
        }

        /* Expandable row styles */
        .disbursement-row {
            cursor: pointer;
        }

        .disbursement-row:hover {
            background-color: var(--gray-50);
        }

        .disbursement-row.expanded {
            background-color: var(--gray-100);
        }

        .expand-icon {
            transition: transform 0.2s ease;
            color: var(--gray-500);
        }

        .timeline-sub-row {
            display: none;
            background-color: var(--gray-50);
        }

        .timeline-sub-row.show {
            display: table-row;
        }

        .timeline-sub-row td {
            padding: 1rem 1.5rem !important;
        }

        .timeline-container {
            padding: 0.5rem 0;
        }

        /* Horizontal Timeline */
        .horizontal-timeline {
            display: flex;
            flex-wrap: wrap;
            gap: 0;
            position: relative;
            padding: 0.5rem 0;
            justify-content: space-between;
        }

        .timeline-step {
            flex: 1;
            min-width: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            padding: 0 0.5rem;
        }

        .timeline-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 15px;
            left: calc(50% + 16px);
            width: calc(100% - 32px);
            height: 2px;
            background: var(--gray-300);
        }

        .timeline-step.completed:not(:last-child)::after {
            background: var(--success);
        }

        .timeline-step-marker {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-200);
            color: var(--gray-500);
            font-size: 1rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .timeline-step-marker.timeline-marker-success {
            background: var(--success);
            color: var(--white);
        }

        .timeline-step-marker.timeline-marker-primary {
            background: var(--ctc-blue);
            color: var(--white);
        }

        .timeline-step-content {
            font-size: 0.75rem;
        }

        .timeline-step-title {
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.125rem;
        }

        .timeline-step-date {
            color: var(--gray-500);
        }

        .current-step-label {
            color: var(--ctc-blue);
            font-weight: 600;
        }

        .pending-label {
            color: var(--gray-400);
        }

        /* Fix table to span full card width - match .table-wrapper calculation from r4-styles.css */
        .r4-card-body > .disbursement-table {
            width: calc(100% + (var(--spacing-lg) * 2));
        }

        /* Make all action buttons same width */
        .disbursement-table td:last-child .r4-button-sm {
            width: 170px !important;
            text-align: center;
            justify-content: center;
            display: inline-flex !important;
        }
    </style>
}
