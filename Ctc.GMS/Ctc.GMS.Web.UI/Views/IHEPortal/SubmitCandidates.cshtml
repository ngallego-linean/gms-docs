@model SubmitCandidatesViewModel

@{
    ViewData["Title"] = "Submit Candidate List";
}

@section Breadcrumbs {
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "IHEPortal")">IHE Portal</a></li>
        <li class="breadcrumb-item active">Submit Candidates</li>
    </ol>
}

<div class="page-header">
    <h2><i class="mdi mdi-account-multiple-plus-outline"></i> Submit Candidate List</h2>
    <p class="subtitle">@Model.GrantCycleName</p>
</div>

<div class="alert alert-info">
    <i class="mdi mdi-information-outline"></i>
    Submit your list of student teacher candidates for this grant cycle. After submission, the LEA will receive an email notification to complete the application.
</div>

<form method="post" action="@Url.Action("ProcessSubmission", "IHEPortal")" id="candidateForm">
    <input type="hidden" name="IHEId" value="@Model.IHEId" />
    <input type="hidden" name="GrantCycleId" value="@Model.GrantCycleId" />

    <div class="r4-card">
        <div class="r4-card-header">
            <h4><i class="mdi mdi-account-outline"></i> IHE Point of Contact Information</h4>
        </div>
        <div class="r4-card-body">
            <div class="form-row">
                <div class="form-group">
                    <label for="POCFirstName">First Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="POCFirstName" name="POCFirstName" required>
                </div>
                <div class="form-group">
                    <label for="POCLastName">Last Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="POCLastName" name="POCLastName" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="POCEmail">Email <span class="text-danger">*</span></label>
                    <input type="email" class="form-control" id="POCEmail" name="POCEmail" required>
                </div>
                <div class="form-group">
                    <label for="POCPhone">Phone <span class="text-danger">*</span></label>
                    <input type="tel" class="form-control" id="POCPhone" name="POCPhone" placeholder="(555) 123-4567" required>
                </div>
            </div>
        </div>
    </div>

    <div class="r4-card">
        <div class="r4-card-header">
            <h4><i class="mdi mdi-account-group-outline"></i> Candidate Information</h4>
            <div class="card-actions">
                <button type="button" class="r4-button r4-button-primary" onclick="addCandidate()">
                    <i class="mdi mdi-plus"></i> Add Candidate
                </button>
            </div>
        </div>
        <div class="r4-card-body" id="candidatesContainer">
            <div class="empty-state">
                <i class="mdi mdi-account-plus-outline"></i>
                <p>Click "Add Candidate" to begin adding student teacher candidates.</p>
            </div>
        </div>
    </div>

    <div class="r4-card">
        <div class="r4-card-body">
            <div class="form-actions">
                <button type="submit" class="r4-button r4-button-success">
                    <i class="mdi mdi-send-outline"></i> Submit Candidate List
                </button>
                <a href="@Url.Action("Dashboard", "IHEPortal")" class="r4-button r4-button-secondary">
                    <i class="mdi mdi-arrow-left"></i> Cancel
                </a>
            </div>
        </div>
    </div>
</form>

<template id="candidateTemplate">
    <div class="candidate-item">
        <div class="candidate-header">
            <div class="candidate-title">
                <i class="mdi mdi-account-outline"></i>
                <h5>Candidate <span class="candidate-number"></span></h5>
            </div>
            <button type="button" class="r4-button r4-button-danger r4-button-sm" onclick="removeCandidate(this)">
                <i class="mdi mdi-delete-outline"></i> Remove
            </button>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>First Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="Candidates[INDEX].FirstName" required>
            </div>
            <div class="form-group">
                <label>Last Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="Candidates[INDEX].LastName" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Date of Birth <span class="text-danger">*</span></label>
                <input type="date" class="form-control" name="Candidates[INDEX].DateOfBirth" required>
            </div>
            <div class="form-group">
                <label>Last 4 of SSN/ITIN <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="Candidates[INDEX].Last4SSN" maxlength="4" pattern="[0-9]{4}" placeholder="1234" required>
            </div>
        </div>

        <div class="section-divider">
            <i class="mdi mdi-account-details-outline"></i>
            <h6>Demographic Information</h6>
        </div>

        <div class="form-row form-row-3">
            <div class="form-group">
                <label>Race</label>
                <select class="form-control" name="Candidates[INDEX].Race">
                    <option value="">Select...</option>
                    <option value="American Indian or Alaska Native">American Indian or Alaska Native</option>
                    <option value="Asian">Asian</option>
                    <option value="Black or African American">Black or African American</option>
                    <option value="Native Hawaiian or Pacific Islander">Native Hawaiian or Pacific Islander</option>
                    <option value="White">White</option>
                    <option value="Two or More Races">Two or More Races</option>
                </select>
            </div>
            <div class="form-group">
                <label>Ethnicity</label>
                <select class="form-control" name="Candidates[INDEX].Ethnicity">
                    <option value="">Select...</option>
                    <option value="Hispanic or Latino">Hispanic or Latino</option>
                    <option value="Not Hispanic or Latino">Not Hispanic or Latino</option>
                </select>
            </div>
            <div class="form-group">
                <label>Gender</label>
                <select class="form-control" name="Candidates[INDEX].Gender">
                    <option value="">Select...</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Non-binary">Non-binary</option>
                    <option value="Prefer not to say">Prefer not to say</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" name="Candidates[INDEX].HasMultipleDemographics">
                    Checks box for more than one demographic category
                </label>
            </div>
        </div>

        <div class="form-group">
            <label>Credential Area <span class="text-danger">*</span></label>
            <select class="form-control" name="Candidates[INDEX].CredentialArea" required>
                <option value="">Select credential area...</option>
                <option value="Multiple Subject">Multiple Subject</option>
                <option value="Single Subject">Single Subject</option>
                <option value="Education Specialist">Education Specialist</option>
                <option value="Bilingual Authorization">Bilingual Authorization</option>
                <option value="Administrative Services">Administrative Services</option>
            </select>
        </div>

        <div class="form-row form-row-3">
            <div class="form-group">
                <label>County CDS Code <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="Candidates[INDEX].CountyCDSCode" placeholder="19" required>
            </div>
            <div class="form-group">
                <label>LEA CDS Code <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="Candidates[INDEX].LEACDSCode" placeholder="64733" required>
            </div>
            <div class="form-group">
                <label>School CDS Code <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="Candidates[INDEX].SchoolCDSCode" placeholder="0000000" required>
            </div>
        </div>

        <div class="section-divider">
            <i class="mdi mdi-account-tie-outline"></i>
            <h6>LEA Point of Contact</h6>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>LEA POC First Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="Candidates[INDEX].LEAPOCFirstName" required>
            </div>
            <div class="form-group">
                <label>LEA POC Last Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="Candidates[INDEX].LEAPOCLastName" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>LEA POC Email <span class="text-danger">*</span></label>
                <input type="email" class="form-control" name="Candidates[INDEX].LEAPOCEmail" required>
            </div>
            <div class="form-group">
                <label>LEA POC Phone <span class="text-danger">*</span></label>
                <input type="tel" class="form-control" name="Candidates[INDEX].LEAPOCPhone" placeholder="(555) 123-4567" required>
            </div>
        </div>

        <hr>
    </div>
</template>

@section Scripts {
    <script>
        let candidateCount = 0;

        function addCandidate() {
            const template = document.getElementById('candidateTemplate');
            const container = document.getElementById('candidatesContainer');

            if (candidateCount === 0) {
                container.innerHTML = '';
            }

            const clone = template.content.cloneNode(true);
            const html = clone.querySelector('.candidate-item').outerHTML.replace(/INDEX/g, candidateCount);

            const div = document.createElement('div');
            div.innerHTML = html;
            const candidateItem = div.firstChild;

            candidateItem.querySelector('.candidate-number').textContent = candidateCount + 1;

            container.appendChild(candidateItem);
            candidateCount++;
        }

        function removeCandidate(button) {
            if (confirm('Remove this candidate from the list?')) {
                const candidateItem = button.closest('.candidate-item');
                candidateItem.remove();

                const remaining = document.querySelectorAll('.candidate-item');
                if (remaining.length === 0) {
                    document.getElementById('candidatesContainer').innerHTML = '<div class="empty-state"><i class="mdi mdi-account-plus-outline"></i><p>Click "Add Candidate" to begin adding student teacher candidates.</p></div>';
                    candidateCount = 0;
                } else {
                    remaining.forEach((item, index) => {
                        item.querySelector('.candidate-number').textContent = index + 1;
                    });
                }
            }
        }

        document.getElementById('candidateForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const candidates = document.querySelectorAll('.candidate-item');

            if (candidates.length === 0) {
                alert('Please add at least one candidate to the list.');
                return;
            }

            if (confirm(`Submit ${candidates.length} candidate(s) to LEA partner(s)?\n\nThe LEA will receive an email notification to complete the application.`)) {
                alert(`Candidate list submitted!\n\nIn production, this would:\n1. Create application records for each candidate\n2. Send email notifications to LEA contacts\n3. Mark candidates as "Pending LEA Completion"\n4. Redirect to dashboard`);

                window.location.href = '@Url.Action("Dashboard", "IHEPortal", new { iheId = Model.IHEId, grantCycleId = Model.GrantCycleId })';
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            addCandidate();
        });
    </script>
}
