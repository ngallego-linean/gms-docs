@model SubmitCandidatesViewModel

@{
    ViewData["Title"] = "Submit Candidate List";
}

@section Breadcrumbs {
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "IHEPortal")">IHE Portal</a></li>
        <li class="breadcrumb-item active">Submit Candidates</li>
    </ol>
}

<div class="page-header">
    <h2><i class="mdi mdi-account-multiple-plus-outline"></i> Submit Candidate List</h2>
    <p class="subtitle">@Model.GrantCycleName</p>
</div>

<div class="alert alert-info" id="infoBanner">
    <i class="mdi mdi-information-outline"></i>
    Submit your list of student teacher candidates for this grant cycle. After submission, the LEA will receive an email notification to complete the application.
</div>

<div class="alert alert-success" id="successBanner" style="display: none;">
    <i class="mdi mdi-check-circle-outline"></i>
    <strong>Candidates submitted to LEAs!</strong> You can view your submissions on the <a href="@Url.Action("Applications", "IHEPortal", new { iheId = Model.IHEId, grantCycleId = Model.GrantCycleId })">Applications page</a>.
</div>

@* Submission Method Tabs *@
<div class="submission-tabs">
    <button type="button" class="r4-button r4-button-primary" data-tab="bulk" onclick="switchTab('bulk')">
        <i class="mdi mdi-file-upload-outline"></i> Bulk Upload
    </button>
    <button type="button" class="r4-button" data-tab="manual" onclick="switchTab('manual')">
        <i class="mdi mdi-account-edit-outline"></i> Manual Entry
    </button>
</div>

@* Manual Entry Tab Content *@
<div class="tab-content" data-tab-content="manual" style="display: none;">
    <form method="post" action="@Url.Action("ProcessSubmission", "IHEPortal")" id="candidateForm">
        <input type="hidden" name="IHEId" value="@Model.IHEId" />
        <input type="hidden" name="GrantCycleId" value="@Model.GrantCycleId" />

        <div class="r4-card">
            <div class="r4-card-header">
                <h4><i class="mdi mdi-account-outline"></i> IHE Point of Contact Information</h4>
            </div>
            <div class="r4-card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="POCFirstName">First Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="POCFirstName" name="POCFirstName" required>
                    </div>
                    <div class="form-group">
                        <label for="POCLastName">Last Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="POCLastName" name="POCLastName" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="POCEmail">Email <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" id="POCEmail" name="POCEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="POCPhone">Phone <span class="text-danger">*</span></label>
                        <input type="tel" class="form-control" id="POCPhone" name="POCPhone" placeholder="(555) 123-4567" required>
                    </div>
                </div>
            </div>
        </div>

        <div class="r4-card">
            <div class="r4-card-header">
                <h4><i class="mdi mdi-account-group-outline"></i> Candidate Information</h4>
                <div class="card-actions">
                    <button type="button" class="r4-button r4-button-primary" onclick="addCandidate()">
                        <i class="mdi mdi-plus"></i> Add Candidate
                    </button>
                </div>
            </div>
            <div class="r4-card-body" id="candidatesContainer">
                <div class="empty-state">
                    <i class="mdi mdi-account-plus-outline"></i>
                    <p>Click "Add Candidate" to begin adding student teacher candidates.</p>
                </div>
            </div>
        </div>

        <div class="form-actions mt-4">
            <button type="submit" class="r4-button r4-button-success">
                <i class="mdi mdi-send-outline"></i> Submit Candidate List
            </button>
            <a href="@Url.Action("Dashboard", "IHEPortal")" class="r4-button r4-button-secondary">
                <i class="mdi mdi-arrow-left"></i> Cancel
            </a>
        </div>
    </form>
</div>

@* Bulk Upload Tab Content *@
<div class="tab-content" data-tab-content="bulk">
    <div class="r4-card">
        <div class="r4-card-header">
            <h4><i class="mdi mdi-file-upload-outline"></i> Upload Candidate File</h4>
            <div class="card-actions">
                <a href="@Url.Action("DownloadCandidateTemplate", "IHEPortal")" class="r4-button r4-button-primary">
                    <i class="mdi mdi-file-excel"></i> Download Excel Template
                </a>
            </div>
        </div>
        <div class="r4-card-body">
            <div class="required-fields-compact">
                <p class="required-fields-label"><i class="mdi mdi-format-list-checks"></i> <strong>Required Fields:</strong></p>
                <div class="field-tags">
                    <span class="field-tag">First Name</span>
                    <span class="field-tag">Last Name</span>
                    <span class="field-tag">DOB</span>
                    <span class="field-tag">Credential Area</span>
                    <span class="field-tag">County CDS</span>
                    <span class="field-tag">LEA CDS</span>
                    <span class="field-tag">School CDS</span>
                    <span class="field-tag">LEA POC Name</span>
                    <span class="field-tag">LEA POC Email</span>
                    <span class="field-tag">LEA POC Phone</span>
                    <span class="field-tag field-tag-optional">Race</span>
                    <span class="field-tag field-tag-optional">Ethnicity</span>
                    <span class="field-tag field-tag-optional">Gender</span>
                </div>
            </div>

            <form id="bulkUploadForm" enctype="multipart/form-data">
                <input type="hidden" name="iheId" value="@Model.IHEId" />
                <input type="hidden" name="grantCycleId" value="@Model.GrantCycleId" />

                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon" id="uploadIcon">
                        <i class="mdi mdi-cloud-upload-outline"></i>
                    </div>
                    <h5 id="uploadTitle">Drag and drop your Excel file here</h5>
                    <p class="text-muted" id="uploadSubtitle">or click to browse</p>
                    <input type="file" id="fileInput" name="file" accept=".xlsx,.xls,.csv" style="display: none;" />
                    <button type="button" class="r4-button r4-button-primary mt-3" id="chooseFileBtn" onclick="simulateFileUpload()">
                        <i class="mdi mdi-folder-open-outline"></i> Choose File
                    </button>
                </div>

                <div id="fileInfo" class="file-info mt-3" style="display: none;">
                    <div class="alert alert-success">
                        <i class="mdi mdi-file-check-outline"></i>
                        <strong>Selected file:</strong> <span id="fileName"></span> (<span id="fileSize"></span>)
                    </div>
                </div>

                <div class="form-actions mt-4" id="uploadActions">
                    <button type="submit" class="r4-button r4-button-primary" id="uploadButton" disabled>
                        <i class="mdi mdi-upload"></i> Submit Candidates
                    </button>
                    <a href="@Url.Action("Dashboard", "IHEPortal", new { iheId = Model.IHEId, grantCycleId = Model.GrantCycleId })" class="r4-button">
                        <i class="mdi mdi-arrow-left"></i> Cancel
                    </a>
                </div>
            </form>

            <div id="uploadProgress" class="upload-progress mt-4" style="display: none;">
                <h5>Processing Upload...</h5>
                <div class="progress">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                </div>
                <p class="text-muted mt-2">Please wait while we process your file...</p>
            </div>

            <div id="uploadResults" class="upload-results mt-4" style="display: none;">
                <!-- Results will be displayed here -->
            </div>
        </div>
    </div>

    <!-- Student Data Table (shown after file processing) -->
    <div class="r4-card" id="studentTableCard" style="display: none;">
        <div class="r4-card-header">
            <h4><i class="mdi mdi-account-group-outline"></i> Uploaded Candidates</h4>
            <div class="card-header-actions">
                <span class="badge badge-success" id="validCount">4 Valid</span>
                <span class="badge badge-danger" id="errorCount">1 Error</span>
            </div>
        </div>
        <div class="r4-card-body">
            <div class="table-responsive">
                <table class="r4-table" id="studentTable">
                    <thead>
                        <tr>
                            <th scope="col">Name</th>
                            <th scope="col">Date of Birth</th>
                            <th scope="col">Credential Area</th>
                            <th scope="col">LEA</th>
                            <th scope="col">Status</th>
                            <th scope="col">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="studentTableBody">
                        <!-- Mock data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Edit Student Modal -->
<div class="modal-backdrop" id="editModalBackdrop" style="display: none;" onclick="closeEditModal()"></div>
<div class="edit-modal" id="editModal" style="display: none;">
    <div class="r4-card">
        <div class="r4-card-header">
            <div>
                <h4><i class="mdi mdi-account-edit-outline"></i> Edit Student</h4>
                <p class="modal-subtitle" id="editStudentName"></p>
            </div>
            <button type="button" class="modal-close-btn" onclick="closeEditModal()">
                <i class="mdi mdi-close"></i>
            </button>
        </div>
        <div class="r4-card-body">
            <!-- Error Alert (shown only for error rows) -->
            <div class="alert alert-danger" id="editErrorAlert" style="display: none;">
                <i class="mdi mdi-alert-circle-outline"></i>
                <strong>Error:</strong> <span id="editErrorMessage"></span>
            </div>

            <form id="editStudentForm">
                <input type="hidden" id="editStudentId" />

                <!-- Basic Info -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="editFirstName">First Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editFirstName" required />
                    </div>
                    <div class="form-group">
                        <label for="editLastName">Last Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editLastName" required />
                    </div>
                </div>

                <div class="form-group">
                    <label for="editDOB">Date of Birth <span class="text-danger">*</span></label>
                    <input type="date" class="form-control" id="editDOB" required />
                </div>

                <!-- Demographic Information -->
                <div class="section-divider">
                    <i class="mdi mdi-account-details-outline"></i>
                    <h6>Demographic Information</h6>
                </div>

                <div class="form-row form-row-3">
                    <div class="form-group">
                        <label for="editRace">Race</label>
                        <select class="form-control" id="editRace">
                            <option value="">Select...</option>
                            <option value="American Indian or Alaska Native">American Indian or Alaska Native</option>
                            <option value="Asian">Asian</option>
                            <option value="Black or African American">Black or African American</option>
                            <option value="Native Hawaiian or Pacific Islander">Native Hawaiian or Pacific Islander</option>
                            <option value="White">White</option>
                            <option value="Two or More Races">Two or More Races</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editEthnicity">Ethnicity</label>
                        <select class="form-control" id="editEthnicity">
                            <option value="">Select...</option>
                            <option value="Hispanic or Latino">Hispanic or Latino</option>
                            <option value="Not Hispanic or Latino">Not Hispanic or Latino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editGender">Gender</label>
                        <select class="form-control" id="editGender">
                            <option value="">Select...</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Non-binary">Non-binary</option>
                            <option value="Prefer not to say">Prefer not to say</option>
                        </select>
                    </div>
                </div>

                <!-- Credential Information -->
                <div class="section-divider">
                    <i class="mdi mdi-certificate-outline"></i>
                    <h6>Credential Information</h6>
                </div>

                <div class="form-group">
                    <label for="editCredential">Credential Area <span class="text-danger">*</span></label>
                    <select class="form-control" id="editCredential" required>
                        <option value="">Select credential area...</option>
                        <option value="Multiple Subject">Multiple Subject</option>
                        <option value="Single Subject">Single Subject</option>
                        <option value="Education Specialist">Education Specialist</option>
                        <option value="Bilingual Authorization">Bilingual Authorization</option>
                        <option value="Administrative Services">Administrative Services</option>
                    </select>
                </div>

                <!-- Clinical Placement -->
                <div class="section-divider">
                    <i class="mdi mdi-school-outline"></i>
                    <h6>Clinical Placement</h6>
                </div>

                <div class="form-row form-row-3">
                    <div class="form-group">
                        <label for="editCounty">County <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editCounty" required />
                    </div>
                    <div class="form-group">
                        <label for="editDistrict">School District <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editDistrict" required />
                    </div>
                    <div class="form-group">
                        <label for="editSchool">School <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editSchool" required />
                    </div>
                </div>

                <!-- LEA Partner Information -->
                <div class="section-divider">
                    <i class="mdi mdi-domain"></i>
                    <h6>LEA Partner Information</h6>
                </div>

                <div class="form-group">
                    <label for="editLeaDistrict">LEA District</label>
                    <input type="text" class="form-control" id="editLeaDistrict" readonly />
                </div>

                <div class="form-group">
                    <label for="editPocName">LEA Point of Contact <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="editPocName" required />
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editPocEmail">POC Email <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" id="editPocEmail" required />
                    </div>
                    <div class="form-group">
                        <label for="editPocPhone">POC Phone <span class="text-danger">*</span></label>
                        <input type="tel" class="form-control" id="editPocPhone" placeholder="(555) 123-4567" required />
                    </div>
                </div>

                <!-- Multiple Placement Checkbox -->
                <div class="form-group">
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="editMultiplePlacement" onchange="toggleEditMultiplePlacement(this)">
                            Check box for more than one placement
                        </label>
                    </div>
                </div>

                <!-- Second Placement (hidden by default) -->
                <div id="editAdditionalPlacement" style="display: none;">
                    <div class="section-divider">
                        <i class="mdi mdi-school-outline"></i>
                        <h6>Clinical Placement (2nd)</h6>
                    </div>

                    <div class="form-row form-row-3">
                        <div class="form-group">
                            <label for="editCounty2">County (2nd)</label>
                            <input type="text" class="form-control" id="editCounty2" />
                        </div>
                        <div class="form-group">
                            <label for="editDistrict2">School District (2nd)</label>
                            <input type="text" class="form-control" id="editDistrict2" />
                        </div>
                        <div class="form-group">
                            <label for="editSchool2">School (2nd)</label>
                            <input type="text" class="form-control" id="editSchool2" />
                        </div>
                    </div>

                    <div class="section-divider">
                        <i class="mdi mdi-domain"></i>
                        <h6>LEA Partner Information (2nd Placement)</h6>
                    </div>

                    <div class="form-group">
                        <label for="editLeaDistrict2">LEA District (2nd)</label>
                        <input type="text" class="form-control" id="editLeaDistrict2" readonly />
                    </div>

                    <div class="form-group">
                        <label for="editPocName2">LEA Point of Contact (2nd)</label>
                        <input type="text" class="form-control" id="editPocName2" />
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editPocEmail2">POC Email (2nd)</label>
                            <input type="email" class="form-control" id="editPocEmail2" />
                        </div>
                        <div class="form-group">
                            <label for="editPocPhone2">POC Phone (2nd)</label>
                            <input type="tel" class="form-control" id="editPocPhone2" placeholder="(555) 123-4567" />
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="r4-card-footer">
            <button type="button" class="r4-button r4-button-primary" onclick="saveStudent()">
                <i class="mdi mdi-content-save"></i> Save
            </button>
            <button type="button" class="r4-button" onclick="closeEditModal()">
                <i class="mdi mdi-close"></i> Cancel
            </button>
        </div>
    </div>
</div>

<template id="candidateTemplate">
    <div class="candidate-item">
        <div class="candidate-header">
            <div class="candidate-title">
                <i class="mdi mdi-account-outline"></i>
                <h5>Candidate <span class="candidate-number"></span></h5>
            </div>
            <button type="button" class="r4-button r4-button-danger r4-button-sm" onclick="removeCandidate(this)">
                <i class="mdi mdi-delete-outline"></i> Remove
            </button>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>First Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="Candidates[INDEX].FirstName" required>
            </div>
            <div class="form-group">
                <label>Last Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="Candidates[INDEX].LastName" required>
            </div>
        </div>

        <div class="form-group">
            <label>Date of Birth <span class="text-danger">*</span></label>
            <input type="date" class="form-control" name="Candidates[INDEX].DateOfBirth" required>
        </div>

        <div class="section-divider">
            <i class="mdi mdi-account-details-outline"></i>
            <h6>Demographic Information</h6>
        </div>

        <div class="form-row form-row-3">
            <div class="form-group">
                <label>Race</label>
                <select class="form-control" name="Candidates[INDEX].Race">
                    <option value="">Select...</option>
                    <option value="American Indian or Alaska Native">American Indian or Alaska Native</option>
                    <option value="Asian">Asian</option>
                    <option value="Black or African American">Black or African American</option>
                    <option value="Native Hawaiian or Pacific Islander">Native Hawaiian or Pacific Islander</option>
                    <option value="White">White</option>
                    <option value="Two or More Races">Two or More Races</option>
                </select>
            </div>
            <div class="form-group">
                <label>Ethnicity</label>
                <select class="form-control" name="Candidates[INDEX].Ethnicity">
                    <option value="">Select...</option>
                    <option value="Hispanic or Latino">Hispanic or Latino</option>
                    <option value="Not Hispanic or Latino">Not Hispanic or Latino</option>
                </select>
            </div>
            <div class="form-group">
                <label>Gender</label>
                <select class="form-control" name="Candidates[INDEX].Gender">
                    <option value="">Select...</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Non-binary">Non-binary</option>
                    <option value="Prefer not to say">Prefer not to say</option>
                </select>
            </div>
        </div>

        <div class="section-divider">
            <i class="mdi mdi-certificate-outline"></i>
            <h6>Credential Information</h6>
        </div>

        <div class="form-group">
            <label>Credential Area <span class="text-danger">*</span></label>
            <select class="form-control" name="Candidates[INDEX].CredentialArea" required>
                <option value="">Select credential area...</option>
                <option value="Multiple Subject">Multiple Subject</option>
                <option value="Single Subject">Single Subject</option>
                <option value="Education Specialist">Education Specialist</option>
                <option value="Bilingual Authorization">Bilingual Authorization</option>
                <option value="Administrative Services">Administrative Services</option>
            </select>
        </div>

        <div class="section-divider">
            <i class="mdi mdi-school-outline"></i>
            <h6>Clinical Placement</h6>
        </div>

        <div class="form-row form-row-3">
            <div class="form-group">
                <label>County <span class="text-danger">*</span></label>
                <select class="form-control ecs-county-select" name="Candidates[INDEX].CountyCode" required>
                    <option value="">-- Select County --</option>
                </select>
                <input type="hidden" name="Candidates[INDEX].CountyCDSCode" class="county-cds-hidden">
            </div>
            <div class="form-group">
                <label>School District <span class="text-danger">*</span></label>
                <select class="form-control ecs-district-select" name="Candidates[INDEX].DistrictCdsCode" required disabled>
                    <option value="">-- Select District --</option>
                </select>
                <input type="hidden" name="Candidates[INDEX].LEACDSCode" class="district-cds-hidden">
            </div>
            <div class="form-group">
                <label>School <span class="text-danger">*</span></label>
                <select class="form-control ecs-school-select" name="Candidates[INDEX].SchoolCdsCode" required disabled>
                    <option value="">-- Select School --</option>
                </select>
                <input type="hidden" name="Candidates[INDEX].SchoolCDSCode" class="school-cds-hidden">
            </div>
        </div>

        <div class="section-divider">
            <i class="mdi mdi-domain"></i>
            <h6>LEA Partner Information</h6>
        </div>

        <div class="alert alert-info" style="font-size: 0.9rem; padding: 0.75rem;">
            <i class="mdi mdi-information-outline"></i>
            The LEA District is automatically determined by the school district selected above.
            Select an existing contact or enter new contact information.
        </div>

        <div class="form-group">
            <label>LEA District</label>
            <input type="text" class="form-control lea-district-display" readonly placeholder="(Selected from Clinical Placement above)">
            <input type="hidden" name="Candidates[INDEX].LEAId" class="lea-district-hidden">
        </div>

        <div class="form-group">
            <label>LEA Point of Contact <span class="text-danger">*</span></label>
            <div class="ecs-contact-selector">
                <input type="text" class="form-control ecs-contact-input" name="Candidates[INDEX].LEAPOCName"
                       placeholder="Start typing or click to select from ECS contacts..." required>
                <small class="form-text text-muted">Select from existing ECS contacts or enter a new contact.</small>
            </div>
            <input type="hidden" name="Candidates[INDEX].LEAPOCFirstName" class="poc-first-name-hidden">
            <input type="hidden" name="Candidates[INDEX].LEAPOCLastName" class="poc-last-name-hidden">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>POC Email <span class="text-danger">*</span></label>
                <input type="email" class="form-control ecs-poc-email" name="Candidates[INDEX].LEAPOCEmail" required>
            </div>
            <div class="form-group">
                <label>POC Phone <span class="text-danger">*</span></label>
                <input type="tel" class="form-control ecs-poc-phone" name="Candidates[INDEX].LEAPOCPhone" placeholder="(555) 123-4567" required>
            </div>
        </div>

        <div class="form-group" style="margin-top: 1rem; padding: 0.75rem; background: var(--gray-50); border-radius: 6px; border-left: 3px solid var(--primary);">
            <label style="display: flex; align-items: center; gap: 0.5rem; margin: 0; cursor: pointer;">
                <input type="checkbox" class="multiple-placement-toggle" name="Candidates[INDEX].HasMultiplePlacements" onchange="toggleMultiplePlacement(this)" style="width: 18px; height: 18px;">
                <span>Check box for more than one placement</span>
            </label>
        </div>

        <div class="additional-placement" style="display: none; margin-top: 0; padding-top: 0;">
            <div class="section-divider" style="margin-top: 1rem;">
                <i class="mdi mdi-school-outline"></i>
                <h6>Clinical Placement (2nd)</h6>
            </div>

            <div class="form-row form-row-3">
                <div class="form-group">
                    <label>County (2nd)</label>
                    <select class="form-control ecs-county-select-2" name="Candidates[INDEX].CountyCode2">
                        <option value="">-- Select County --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>School District (2nd)</label>
                    <select class="form-control ecs-district-select-2" name="Candidates[INDEX].DistrictCdsCode2" disabled>
                        <option value="">-- Select District --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>School (2nd)</label>
                    <select class="form-control ecs-school-select-2" name="Candidates[INDEX].SchoolCdsCode2" disabled>
                        <option value="">-- Select School --</option>
                    </select>
                </div>
            </div>

            <div class="section-divider">
                <i class="mdi mdi-domain"></i>
                <h6>LEA Partner Information (2nd Placement)</h6>
            </div>

            <div class="form-group">
                <label>LEA District (2nd)</label>
                <input type="text" class="form-control lea-district-display-2" readonly placeholder="(Selected from 2nd Clinical Placement above)">
                <input type="hidden" name="Candidates[INDEX].LEAId2" class="lea-district-hidden-2">
            </div>

            <div class="form-group">
                <label>LEA Point of Contact (2nd) <span class="text-danger">*</span></label>
                <input type="text" class="form-control ecs-contact-input-2" name="Candidates[INDEX].LEAPOCName2" placeholder="Start typing or click to select from ECS contacts...">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>POC Email (2nd) <span class="text-danger">*</span></label>
                    <input type="email" class="form-control ecs-poc-email-2" name="Candidates[INDEX].LEAPOCEmail2">
                </div>
                <div class="form-group">
                    <label>POC Phone (2nd) <span class="text-danger">*</span></label>
                    <input type="tel" class="form-control ecs-poc-phone-2" name="Candidates[INDEX].LEAPOCPhone2" placeholder="(555) 123-4567">
                </div>
            </div>
        </div>

        <hr>
    </div>
</template>

@section Scripts {
    <script src="~/js/ecs-integration.js" asp-append-version="true"></script>
    <script>
        // Multiple Placement Toggle
        function toggleMultiplePlacement(checkbox) {
            const candidateItem = checkbox.closest('.candidate-item');
            const additionalPlacement = candidateItem.querySelector('.additional-placement');
            if (checkbox.checked) {
                additionalPlacement.style.display = 'block';
            } else {
                additionalPlacement.style.display = 'none';
            }
        }

        // Tab Switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.submission-tabs button').forEach(btn => {
                if (btn.dataset.tab === tabName) {
                    btn.classList.add('r4-button-primary');
                } else {
                    btn.classList.remove('r4-button-primary');
                }
            });

            // Show/hide tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                if (content.dataset.tabContent === tabName) {
                    content.style.display = 'block';
                } else {
                    content.style.display = 'none';
                }
            });
        }

        // Manual Entry Functions
        let candidateCount = 0;

        function addCandidate() {
            const template = document.getElementById('candidateTemplate');
            const container = document.getElementById('candidatesContainer');

            if (candidateCount === 0) {
                container.innerHTML = '';
            }

            const clone = template.content.cloneNode(true);
            const html = clone.querySelector('.candidate-item').outerHTML.replace(/INDEX/g, candidateCount);

            const div = document.createElement('div');
            div.innerHTML = html;
            const candidateItem = div.firstChild;

            candidateItem.querySelector('.candidate-number').textContent = candidateCount + 1;

            container.appendChild(candidateItem);

            // Initialize ECS cascading dropdowns for this candidate
            initializeCandidateECS(candidateItem);

            candidateCount++;
        }

        // Initialize ECS integration for a candidate item
        function initializeCandidateECS(candidateItem) {
            const countySelect = candidateItem.querySelector('.ecs-county-select');
            const districtSelect = candidateItem.querySelector('.ecs-district-select');
            const schoolSelect = candidateItem.querySelector('.ecs-school-select');
            const leaDistrictDisplay = candidateItem.querySelector('.lea-district-display');
            const leaDistrictHidden = candidateItem.querySelector('.lea-district-hidden');
            const contactInput = candidateItem.querySelector('.ecs-contact-input');
            const pocEmailInput = candidateItem.querySelector('.ecs-poc-email');
            const pocPhoneInput = candidateItem.querySelector('.ecs-poc-phone');
            const pocFirstNameHidden = candidateItem.querySelector('.poc-first-name-hidden');
            const pocLastNameHidden = candidateItem.querySelector('.poc-last-name-hidden');

            // Initialize cascading dropdowns
            ECS.initCascadingDropdowns(countySelect, districtSelect, schoolSelect, {
                onChange: (selection) => {
                    // Update LEA district display when district is selected
                    if (selection.district) {
                        const selectedOption = districtSelect.options[districtSelect.selectedIndex];
                        leaDistrictDisplay.value = selectedOption.textContent;
                        leaDistrictHidden.value = selection.district;

                        // Enable contact autocomplete for the selected district
                        initContactAutocomplete(contactInput, selection.district, pocEmailInput, pocPhoneInput, pocFirstNameHidden, pocLastNameHidden);
                    } else {
                        leaDistrictDisplay.value = '';
                        leaDistrictHidden.value = '';
                    }
                }
            });

            // Initialize secondary placement dropdowns if they exist
            const countySelect2 = candidateItem.querySelector('.ecs-county-select-2');
            const districtSelect2 = candidateItem.querySelector('.ecs-district-select-2');
            const schoolSelect2 = candidateItem.querySelector('.ecs-school-select-2');

            if (countySelect2 && districtSelect2 && schoolSelect2) {
                ECS.initCascadingDropdowns(countySelect2, districtSelect2, schoolSelect2);
            }
        }

        // Initialize contact autocomplete for LEA POC
        function initContactAutocomplete(input, districtCdsCode, emailInput, phoneInput, firstNameHidden, lastNameHidden) {
            let dropdown = null;

            const showContacts = async () => {
                try {
                    const contacts = await ECS.loadContacts(districtCdsCode, 'GMS_CONTACT');

                    // Remove existing dropdown
                    if (dropdown) dropdown.remove();

                    dropdown = document.createElement('div');
                    dropdown.className = 'ecs-contact-dropdown';
                    dropdown.style.cssText = `
                        position: absolute;
                        background: white;
                        border: 1px solid #ccc;
                        border-radius: 4px;
                        max-height: 200px;
                        overflow-y: auto;
                        width: ${input.offsetWidth}px;
                        z-index: 1000;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
                    `;

                    if (contacts.length > 0) {
                        contacts.forEach(contact => {
                            const item = document.createElement('div');
                            item.className = 'ecs-contact-item';
                            item.style.cssText = 'padding: 8px 12px; cursor: pointer; border-bottom: 1px solid #eee;';
                            item.innerHTML = `<strong>${contact.name}</strong><br><small>${contact.email} | ${contact.title || 'Contact'}</small>`;
                            item.addEventListener('click', () => {
                                // Populate fields from ECS contact
                                input.value = contact.name;
                                emailInput.value = contact.email;
                                phoneInput.value = contact.phone || '';

                                // Split name for hidden fields
                                const nameParts = contact.name.split(' ');
                                firstNameHidden.value = nameParts[0] || '';
                                lastNameHidden.value = nameParts.slice(1).join(' ') || '';

                                dropdown.remove();
                                dropdown = null;
                            });
                            item.addEventListener('mouseenter', () => item.style.backgroundColor = '#f5f5f5');
                            item.addEventListener('mouseleave', () => item.style.backgroundColor = '');
                            dropdown.appendChild(item);
                        });
                    } else {
                        const noResults = document.createElement('div');
                        noResults.style.cssText = 'padding: 8px 12px; color: #666; font-style: italic;';
                        noResults.textContent = 'No ECS contacts found for this district';
                        dropdown.appendChild(noResults);
                    }

                    // Add "Enter manually" option
                    const manualOption = document.createElement('div');
                    manualOption.style.cssText = 'padding: 8px 12px; cursor: pointer; color: #0066cc; font-style: italic; border-top: 1px solid #ddd;';
                    manualOption.textContent = '+ Enter new contact manually';
                    manualOption.addEventListener('click', () => {
                        dropdown.remove();
                        dropdown = null;
                        input.focus();
                        input.select();
                    });
                    dropdown.appendChild(manualOption);

                    // Position dropdown
                    const rect = input.getBoundingClientRect();
                    dropdown.style.position = 'fixed';
                    dropdown.style.left = rect.left + 'px';
                    dropdown.style.top = rect.bottom + 'px';

                    document.body.appendChild(dropdown);
                } catch (error) {
                    console.error('Error loading contacts:', error);
                }
            };

            // Remove any existing listeners
            input.removeEventListener('focus', showContacts);

            // Add focus listener
            input.addEventListener('focus', showContacts);

            // Close on outside click
            document.addEventListener('click', (e) => {
                if (dropdown && !dropdown.contains(e.target) && e.target !== input) {
                    dropdown.remove();
                    dropdown = null;
                }
            });

            // Handle manual name entry - split into first/last
            input.addEventListener('blur', () => {
                setTimeout(() => {
                    if (input.value && !firstNameHidden.value) {
                        const nameParts = input.value.trim().split(' ');
                        firstNameHidden.value = nameParts[0] || '';
                        lastNameHidden.value = nameParts.slice(1).join(' ') || '';
                    }
                }, 200);
            });
        }

        function removeCandidate(button) {
            if (confirm('Remove this candidate from the list?')) {
                const candidateItem = button.closest('.candidate-item');
                candidateItem.remove();

                const remaining = document.querySelectorAll('.candidate-item');
                if (remaining.length === 0) {
                    document.getElementById('candidatesContainer').innerHTML = '<div class="empty-state"><i class="mdi mdi-account-plus-outline"></i><p>Click "Add Candidate" to begin adding student teacher candidates.</p></div>';
                    candidateCount = 0;
                } else {
                    remaining.forEach((item, index) => {
                        item.querySelector('.candidate-number').textContent = index + 1;
                    });
                }
            }
        }

        document.getElementById('candidateForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const candidates = document.querySelectorAll('.candidate-item');

            if (candidates.length === 0) {
                alert('Please add at least one candidate to the list.');
                return;
            }

            if (confirm(`Submit ${candidates.length} candidate(s) to LEA partner(s)?\n\nThe LEA will receive an email notification to complete the application.`)) {
                alert(`Candidate list submitted!\n\nIn production, this would:\n1. Create application records for each candidate\n2. Send email notifications to LEA contacts\n3. Mark candidates as "Pending LEA Completion"\n4. Redirect to dashboard`);

                window.location.href = '@Url.Action("Dashboard", "IHEPortal", new { iheId = Model.IHEId, grantCycleId = Model.GrantCycleId })';
            }
        });

        // Bulk Upload Functions
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const uploadButton = document.getElementById('uploadButton');
        const uploadForm = document.getElementById('bulkUploadForm');
        const uploadIcon = document.getElementById('uploadIcon');
        const uploadTitle = document.getElementById('uploadTitle');
        const uploadSubtitle = document.getElementById('uploadSubtitle');
        const chooseFileBtn = document.getElementById('chooseFileBtn');
        const studentTableCard = document.getElementById('studentTableCard');

        // Simulate file upload (no file picker)
        function simulateFileUpload() {
            // Hide success banner, show info banner
            document.getElementById('successBanner').style.display = 'none';
            document.getElementById('infoBanner').style.display = 'block';

            showLoadingState();

            setTimeout(() => {
                hideLoadingState({ name: 'candidates_batch_2024.xlsx', size: 45056 });
                showStudentTable();
                uploadButton.disabled = false;
            }, 1500);
        }

        // Mock student data with all required fields
        const mockStudents = [
            { id: 1, firstName: 'Maria', lastName: 'Garcia', dob: '1998-03-15', credential: 'Multiple Subject', county: 'Los Angeles', district: 'Los Angeles USD', school: 'Jefferson Elementary', lea: 'Los Angeles USD', pocName: 'Robert Martinez', pocEmail: 'rmartinez@lausd.net', pocPhone: '(213) 555-0142', race: 'White', ethnicity: 'Hispanic or Latino', gender: 'Female', status: 'valid', errorMessage: '' },
            { id: 2, firstName: 'James', lastName: 'Wilson', dob: '1999-07-22', credential: 'Single Subject', county: 'San Diego', district: 'San Diego USD', school: 'Lincoln High', lea: 'San Diego USD', pocName: 'Patricia Lee', pocEmail: 'plee@sdusd.edu', pocPhone: '(619) 555-0198', race: 'Black or African American', ethnicity: 'Not Hispanic or Latino', gender: 'Male', status: 'valid', errorMessage: '' },
            { id: 3, firstName: 'Sarah', lastName: 'Chen', dob: '1997-11-08', credential: 'Education Specialist', county: 'Fresno', district: 'Fresno USD', school: 'Roosevelt Middle', lea: 'Fresno USD', pocName: 'David Kim', pocEmail: 'dkim@fresnousd.org', pocPhone: '(559) 555-0167', race: 'Asian', ethnicity: 'Not Hispanic or Latino', gender: 'Female', status: 'error', errorMessage: 'Invalid School CDS Code - School not found in Fresno USD district' },
            { id: 4, firstName: 'Michael', lastName: 'Brown', dob: '2000-05-30', credential: 'Multiple Subject', county: 'Sacramento', district: 'Sacramento City USD', school: 'Washington Elementary', lea: 'Sacramento City USD', pocName: 'Jennifer Adams', pocEmail: 'jadams@scusd.edu', pocPhone: '(916) 555-0134', race: 'Two or More Races', ethnicity: 'Not Hispanic or Latino', gender: 'Male', status: 'valid', errorMessage: '' },
            { id: 5, firstName: 'Emily', lastName: 'Johnson', dob: '1998-09-12', credential: 'Bilingual Authorization', county: 'Alameda', district: 'Oakland USD', school: 'MLK Jr. High', lea: 'Oakland USD', pocName: 'Michelle Torres', pocEmail: 'mtorres@ousd.org', pocPhone: '(510) 555-0189', race: 'White', ethnicity: 'Not Hispanic or Latino', gender: 'Female', status: 'valid', errorMessage: '' }
        ];

        // Drag and drop handlers
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            if (!uploadArea.classList.contains('is-loading')) {
                uploadArea.classList.add('drag-over');
            }
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');

            if (!uploadArea.classList.contains('is-loading')) {
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        function handleFileSelect(file) {
            // Validate file type
            const validTypes = ['.xlsx', '.xls', '.csv'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();

            if (!validTypes.includes(fileExtension)) {
                alert('Please select a valid Excel (.xlsx, .xls) or CSV (.csv) file.');
                return;
            }

            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('File size must be less than 10MB.');
                return;
            }

            // Show loading state
            showLoadingState();

            // Store file in form
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            fileInput.files = dataTransfer.files;

            // Simulate processing delay
            setTimeout(() => {
                hideLoadingState(file);
                showStudentTable();
                uploadButton.disabled = false;
            }, 1500);
        }

        function showLoadingState() {
            uploadArea.classList.add('is-loading');
            uploadIcon.innerHTML = '<i class="mdi mdi-loading mdi-spin"></i>';
            uploadTitle.textContent = 'Processing file...';
            uploadSubtitle.textContent = 'Please wait while we validate your data';
            chooseFileBtn.style.display = 'none';
            fileInfo.style.display = 'none';
        }

        function hideLoadingState(file) {
            uploadArea.classList.remove('is-loading');
            uploadIcon.innerHTML = '<i class="mdi mdi-file-check-outline"></i>';
            uploadTitle.textContent = 'File processed successfully';
            uploadSubtitle.textContent = 'Review the candidates below';
            chooseFileBtn.style.display = 'none';

            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.style.display = 'block';
        }

        function showStudentTable() {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';

            // Sort students with errors at the top
            const sortedStudents = [...mockStudents].sort((a, b) => {
                if (a.status === 'error' && b.status !== 'error') return -1;
                if (a.status !== 'error' && b.status === 'error') return 1;
                return 0;
            });

            sortedStudents.forEach(student => {
                const row = document.createElement('tr');
                if (student.status === 'error') {
                    row.classList.add('has-error');
                }

                const formattedDob = new Date(student.dob).toLocaleDateString('en-US', {
                    month: '2-digit',
                    day: '2-digit',
                    year: 'numeric'
                });

                const statusBadge = student.status === 'valid'
                    ? '<span class="badge badge-success">Valid</span>'
                    : '<span class="badge badge-danger">Error</span>';

                row.innerHTML = `
                    <td>${student.firstName} ${student.lastName}</td>
                    <td>${formattedDob}</td>
                    <td>${student.credential}</td>
                    <td>${student.lea}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button type="button" class="edit-btn" onclick="openEditModal(${student.id})" title="Edit student">
                            <i class="mdi mdi-pencil"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            studentTableCard.style.display = 'block';
            studentTableCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function openEditModal(studentId) {
            const student = mockStudents.find(s => s.id === studentId);
            if (!student) return;

            // Set student name subtitle
            document.getElementById('editStudentName').textContent = `${student.firstName} ${student.lastName}`;

            // Show/hide error alert
            const errorAlert = document.getElementById('editErrorAlert');
            const errorMessage = document.getElementById('editErrorMessage');
            if (student.status === 'error' && student.errorMessage) {
                errorMessage.textContent = student.errorMessage;
                errorAlert.style.display = 'block';
            } else {
                errorAlert.style.display = 'none';
            }

            // Populate all fields
            document.getElementById('editStudentId').value = student.id;
            document.getElementById('editFirstName').value = student.firstName;
            document.getElementById('editLastName').value = student.lastName;
            document.getElementById('editDOB').value = student.dob;
            document.getElementById('editRace').value = student.race;
            document.getElementById('editEthnicity').value = student.ethnicity;
            document.getElementById('editGender').value = student.gender;
            document.getElementById('editCredential').value = student.credential;
            document.getElementById('editCounty').value = student.county;
            document.getElementById('editDistrict').value = student.district;
            document.getElementById('editSchool').value = student.school;
            document.getElementById('editLeaDistrict').value = student.lea;
            document.getElementById('editPocName').value = student.pocName;
            document.getElementById('editPocEmail').value = student.pocEmail;
            document.getElementById('editPocPhone').value = student.pocPhone;

            // Reset multiple placement checkbox
            document.getElementById('editMultiplePlacement').checked = false;
            document.getElementById('editAdditionalPlacement').style.display = 'none';

            document.getElementById('editModalBackdrop').style.display = 'block';
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModalBackdrop').style.display = 'none';
            document.getElementById('editModal').style.display = 'none';
        }

        function toggleEditMultiplePlacement(checkbox) {
            const additionalPlacement = document.getElementById('editAdditionalPlacement');
            if (checkbox.checked) {
                additionalPlacement.style.display = 'block';
            } else {
                additionalPlacement.style.display = 'none';
            }
        }

        function saveStudent() {
            const studentId = parseInt(document.getElementById('editStudentId').value);
            const student = mockStudents.find(s => s.id === studentId);

            if (student) {
                // Update all fields
                student.firstName = document.getElementById('editFirstName').value;
                student.lastName = document.getElementById('editLastName').value;
                student.dob = document.getElementById('editDOB').value;
                student.race = document.getElementById('editRace').value;
                student.ethnicity = document.getElementById('editEthnicity').value;
                student.gender = document.getElementById('editGender').value;
                student.credential = document.getElementById('editCredential').value;
                student.county = document.getElementById('editCounty').value;
                student.district = document.getElementById('editDistrict').value;
                student.school = document.getElementById('editSchool').value;
                student.pocName = document.getElementById('editPocName').value;
                student.pocEmail = document.getElementById('editPocEmail').value;
                student.pocPhone = document.getElementById('editPocPhone').value;

                if (student.status === 'error') {
                    student.status = 'valid';
                    student.errorMessage = '';
                    document.getElementById('validCount').textContent = '5 Valid';
                    document.getElementById('errorCount').textContent = '0 Errors';
                }

                showStudentTable();
            }

            closeEditModal();
            alert('Student information updated successfully.');
        }

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeEditModal();
            }
        });

        function clearFile() {
            fileInput.value = '';
            fileInfo.style.display = 'none';
            uploadButton.disabled = true;
            studentTableCard.style.display = 'none';
            uploadIcon.innerHTML = '<i class="mdi mdi-cloud-upload-outline"></i>';
            uploadTitle.textContent = 'Drag and drop your Excel file here';
            uploadSubtitle.textContent = 'or click to browse';
            chooseFileBtn.style.display = 'inline-block';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Form submission
        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Show loading state on button
            uploadButton.disabled = true;
            uploadButton.innerHTML = '<i class="mdi mdi-loading mdi-spin"></i> Submitting...';

            // Simulate submission delay
            setTimeout(() => {
                // Hide the student table
                studentTableCard.style.display = 'none';

                // Hide info banner, show success banner
                document.getElementById('infoBanner').style.display = 'none';
                document.getElementById('successBanner').style.display = 'block';

                // Reset upload area so user can upload again
                resetUploadArea();

                // Reset button text
                uploadButton.innerHTML = '<i class="mdi mdi-upload"></i> Submit Candidates';
            }, 1000);
        });

        function resetUploadArea() {
            uploadIcon.innerHTML = '<i class="mdi mdi-cloud-upload-outline"></i>';
            uploadTitle.textContent = 'Drag and drop your Excel file here';
            uploadSubtitle.textContent = 'or click to browse';
            chooseFileBtn.style.display = 'inline-block';
            fileInfo.style.display = 'none';
            uploadButton.disabled = true;
            fileInput.value = '';
        }

        function exportErrors() {
            alert('Mock: Error report CSV would be downloaded here.');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            addCandidate();
        });
    </script>

    <style>
        /* Tab Styling */
        .submission-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.5rem;
            background: var(--gray-100);
            border-radius: 8px;
            width: fit-content;
        }

        .submission-tabs button {
            min-width: 150px;
        }

        /* Upload Area */
        .upload-area {
            border: 3px dashed var(--gray-300);
            border-radius: 8px;
            padding: 3rem 2rem;
            text-align: center;
            background: var(--gray-50);
            transition: all 0.3s;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: var(--ctc-blue);
            background: var(--gray-200);
        }

        .upload-area.drag-over {
            border-color: var(--ctc-blue);
            background: var(--gray-100);
        }

        .upload-area.is-loading {
            pointer-events: none;
            border-color: var(--ctc-blue);
            background: var(--gray-100);
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--gray-600);
            margin-bottom: 1rem;
        }

        .upload-area.is-loading .upload-icon {
            color: var(--ctc-blue);
        }

        .upload-area h5 {
            color: var(--ctc-blue);
            margin-bottom: 0.5rem;
        }

        /* Required Fields Compact */
        .required-fields-compact {
            margin-bottom: 1.5rem;
        }

        .required-fields-label {
            margin-bottom: 0.75rem;
            color: var(--gray-700);
        }

        .field-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .field-tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--ctc-blue);
            color: var(--white);
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .field-tag-optional {
            background: var(--gray-400);
        }

        /* Additional Placement */
        .additional-placement {
            background: var(--gray-50);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 0.5rem;
            border-left: 3px solid var(--ctc-blue);
        }

        /* Upload Summary */
        .upload-summary .summary-card {
            text-align: center;
            padding: 1.5rem;
            background: var(--white);
            border: 1px solid var(--gray-300);
            border-radius: 8px;
        }

        .upload-summary .summary-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--ctc-blue);
        }

        .upload-summary .summary-label {
            color: var(--gray-600);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .upload-summary .summary-card.summary-success .summary-value {
            color: var(--success);
        }

        .upload-summary .summary-card.summary-warning .summary-value {
            color: var(--warning);
        }

        /* Error Details */
        .error-details {
            background: var(--gray-50);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--gray-300);
        }

        .error-details h5 {
            color: var(--danger);
            margin-bottom: 1rem;
        }

        /* Progress Bar */
        .progress {
            height: 30px;
            border-radius: 8px;
        }

        .progress-bar {
            font-size: 1rem;
            line-height: 30px;
        }

        /* Card header actions */
        .card-header-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Student table styles */
        #studentTable tr.has-error {
            background-color: rgba(220, 53, 69, 0.1);
        }

        #studentTable tr.has-error:hover {
            background-color: rgba(220, 53, 69, 0.15);
        }

        .edit-btn {
            background: none;
            border: none;
            color: var(--ctc-blue);
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .edit-btn:hover {
            background-color: var(--gray-100);
            color: var(--ctc-blue-dark, #003366);
        }

        /* Modal styles */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .edit-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1001;
            width: 900px;
            max-width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .edit-modal .r4-card {
            margin: 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .edit-modal .r4-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .edit-modal .r4-card-header h4 {
            margin-bottom: 0.25rem;
        }

        .modal-subtitle {
            color: var(--gray-500);
            font-size: 0.9rem;
            margin: 0;
            font-weight: normal;
        }

        .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-600);
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .modal-close-btn:hover {
            color: var(--gray-900);
        }

        .r4-card-footer {
            padding: 1rem 1.5rem;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        /* Form grid layouts */
        .form-row-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .form-row-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .edit-modal .form-group {
            margin-bottom: 1rem;
        }

        .edit-modal .form-group label {
            display: block;
            margin-bottom: 0.35rem;
            font-weight: 500;
            color: var(--gray-700);
            font-size: 0.85rem;
        }

        .edit-modal .form-control {
            font-size: 0.9rem;
            padding: 0.5rem 0.75rem;
        }

        #editErrorAlert {
            margin-bottom: 1rem;
        }

        /* Section dividers for modal */
        .edit-modal .section-divider {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 1.25rem 0 0.75rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .edit-modal .section-divider i {
            color: var(--ctc-blue);
            font-size: 1.1rem;
        }

        .edit-modal .section-divider h6 {
            margin: 0;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-700);
        }

        /* Form row for 2 columns */
        .edit-modal .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
    </style>
}
