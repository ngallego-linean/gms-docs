@* ~/Views/Home/Index.cshtml *@
@model DashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
}

@section Breadcrumbs {
    <ol class="breadcrumb">
        <li class="breadcrumb-item active">Dashboard</li>
    </ol>
}

@* Page Header *@
<div class="page-header">
    <h2><i class="mdi mdi-shield-check-outline"></i> Grants/Fiscal Team Dashboard</h2>
    <p class="subtitle">@Model.GrantCycleName</p>
</div>

@* GRANTS TEAM - Action Items *@
<div class="r4-card">
    <div class="r4-card-header">
        <h4><i class="mdi mdi-clipboard-check-outline"></i> GRANTS TEAM - Action Items</h4>
    </div>
    <div class="r4-card-body">
        @if (!Model.ApplicationsWithPendingStudents.Any())
        {
            <div class="alert alert-success">
                <i class="mdi mdi-check-circle-outline"></i>
                All caught up! No applications currently need review.
            </div>
        }
        else
        {
            <div class="alert alert-warning">
                <i class="mdi mdi-alert-outline"></i>
                <strong>@Model.PendingReviewCount student application@(Model.PendingReviewCount != 1 ? "s" : "") waiting for review</strong>
            </div>
            <div class="application-cards-grid">
                @foreach (var app in Model.ApplicationsWithPendingStudents)
                {
                    <div class="application-card">
                        <div class="application-card-header">
                            <div class="application-id">#@app.Id</div>
                            <span class="badge badge-warning">Needs Review</span>
                        </div>
                        <div class="application-card-body">
                            <div class="org-info">
                                <div class="org-label">IHE:</div>
                                <div class="org-name">@app.IHEName</div>
                            </div>
                            <div class="org-info">
                                <div class="org-label">LEA:</div>
                                <div class="org-name">@app.LEAName</div>
                            </div>
                            <div class="student-counts">
                                <span class="count-badge">
                                    <i class="mdi mdi-account-alert"></i>
                                    @app.PendingCount Pending
                                </span>
                                <span class="count-badge">
                                    <i class="mdi mdi-account"></i>
                                    @app.TotalStudents Total
                                </span>
                            </div>
                        </div>
                        <div class="application-card-footer">
                            <a asp-controller="Application" asp-action="Details" asp-route-id="@app.Id" class="r4-button r4-button-primary r4-button-sm">
                                <i class="mdi mdi-eye"></i> Review Students
                            </a>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>

@* FISCAL TEAM - Action Items *@
<div class="r4-card">
    <div class="r4-card-header">
        <h4><i class="mdi mdi-currency-usd"></i> FISCAL TEAM - Action Items</h4>
        <div class="card-actions">
            <a href="@Url.Action("GAA", "FiscalTeam", new { grantCycleId = Model.GrantCycleId })" class="r4-button r4-button-primary">
                <i class="mdi mdi-file-plus-outline"></i> Generate GAAs
            </a>
        </div>
    </div>
    <div class="r4-card-body">
        @if (Model.Metrics.StatusCounts.Approved > 0)
        {
            <div class="alert alert-info">
                <i class="mdi mdi-information-outline"></i>
                <strong>@Model.Metrics.StatusCounts.Approved approved student@(Model.Metrics.StatusCounts.Approved != 1 ? "s" : "") ready for GAA processing</strong>
            </div>
        }
        else
        {
            <div class="alert alert-success">
                <i class="mdi mdi-check-circle-outline"></i>
                All caught up! No GAAs currently need processing.
            </div>
        }
    </div>
</div>

@* Budget Utilization *@
<div class="r4-card">
    <div class="r4-card-header">
        <h4><i class="mdi mdi-chart-bar"></i> Budget Utilization</h4>
    </div>
    <div class="r4-card-body">
        <div class="budget-progress">
            <div class="r4-progress">
                @{
                    var reservedPercent = Model.Metrics.ApproprietedAmount > 0
                        ? (Model.Metrics.ReservedAmount / Model.Metrics.ApproprietedAmount * 100)
                        : 0;
                    var encumberedPercent = Model.Metrics.ApproprietedAmount > 0
                        ? (Model.Metrics.EncumberedAmount / Model.Metrics.ApproprietedAmount * 100)
                        : 0;
                    var disbursedPercent = Model.Metrics.ApproprietedAmount > 0
                        ? (Model.Metrics.DisbursedAmount / Model.Metrics.ApproprietedAmount * 100)
                        : 0;
                }
                @if (reservedPercent > 0.1m)
                {
                    <div class="r4-progress-bar r4-progress-bar-reserved"
                         style="width: @reservedPercent%"
                         role="progressbar"
                         aria-valuenow="@reservedPercent" aria-valuemin="0" aria-valuemax="100">
                        Reserved @reservedPercent.ToString("F1")%
                    </div>
                }
                @if (encumberedPercent > 0.1m)
                {
                    <div class="r4-progress-bar r4-progress-bar-encumbered"
                         style="width: @encumberedPercent%"
                         role="progressbar"
                         aria-valuenow="@encumberedPercent" aria-valuemin="0" aria-valuemax="100">
                        Encumbered @encumberedPercent.ToString("F1")%
                    </div>
                }
                @if (disbursedPercent > 0.1m)
                {
                    <div class="r4-progress-bar r4-progress-bar-disbursed"
                         style="width: @disbursedPercent%"
                         role="progressbar"
                         aria-valuenow="@disbursedPercent" aria-valuemin="0" aria-valuemax="100">
                        Disbursed @disbursedPercent.ToString("F1")%
                    </div>
                }
            </div>
            <div style="margin-top: 1rem;">
                <p><strong>Total Appropriated:</strong> @Model.Metrics.ApproprietedAmount.ToString("C0")</p>
                <p><strong>Remaining:</strong> @Model.Metrics.RemainingAmount.ToString("C0") (@Model.Metrics.RemainingPercent.ToString("F1")%)</p>
            </div>
        </div>
    </div>
</div>

