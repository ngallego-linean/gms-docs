@{
    ViewData["Title"] = ViewBag.ReportTitle;

    // Mock data for demographics report
    var students = new[] {
        new { Name = "Maria Garcia", SEID = "ST1234567", LEA = "Los Angeles USD", IHE = "UCLA", CredentialArea = "Multiple Subject", Amount = 10000m, Status = "Approved" },
        new { Name = "James Chen", SEID = "ST1234568", LEA = "Los Angeles USD", IHE = "UCLA", CredentialArea = "Single Subject - Math", Amount = 10000m, Status = "Approved" },
        new { Name = "Sarah Williams", SEID = "ST1234569", LEA = "San Diego USD", IHE = "SDSU", CredentialArea = "Education Specialist", Amount = 10000m, Status = "Approved" },
        new { Name = "Michael Brown", SEID = "ST1234570", LEA = "San Diego USD", IHE = "SDSU", CredentialArea = "Single Subject - English", Amount = 10000m, Status = "Approved" },
        new { Name = "Emily Johnson", SEID = "ST1234571", LEA = "Fresno USD", IHE = "Fresno State", CredentialArea = "Multiple Subject", Amount = 10000m, Status = "Approved" },
        new { Name = "David Martinez", SEID = "ST1234572", LEA = "Fresno USD", IHE = "Fresno State", CredentialArea = "Single Subject - Science", Amount = 10000m, Status = "Approved" },
        new { Name = "Jennifer Lee", SEID = "ST1234573", LEA = "Sacramento City USD", IHE = "Sac State", CredentialArea = "Education Specialist", Amount = 10000m, Status = "Approved" },
        new { Name = "Robert Taylor", SEID = "ST1234574", LEA = "Sacramento City USD", IHE = "Sac State", CredentialArea = "Multiple Subject", Amount = 10000m, Status = "Approved" },
        new { Name = "Lisa Anderson", SEID = "ST1234575", LEA = "Oakland USD", IHE = "Cal State East Bay", CredentialArea = "Single Subject - Math", Amount = 10000m, Status = "Approved" },
        new { Name = "Kevin Wilson", SEID = "ST1234576", LEA = "Oakland USD", IHE = "Cal State East Bay", CredentialArea = "Education Specialist", Amount = 10000m, Status = "Approved" }
    };

    var credentialBreakdown = new[] {
        new { Area = "Multiple Subject", Count = 3, Percent = 30.0 },
        new { Area = "Single Subject - Math", Count = 2, Percent = 20.0 },
        new { Area = "Single Subject - English", Count = 1, Percent = 10.0 },
        new { Area = "Single Subject - Science", Count = 1, Percent = 10.0 },
        new { Area = "Education Specialist", Count = 3, Percent = 30.0 }
    };

    var regionBreakdown = new[] {
        new { Region = "Southern California", Count = 4, Percent = 40.0 },
        new { Region = "Central California", Count = 2, Percent = 20.0 },
        new { Region = "Northern California", Count = 4, Percent = 40.0 }
    };
}

@section Breadcrumbs {
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "GrantsTeam")">Grants Team</a></li>
        <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "Reporting")">Reporting</a></li>
        <li class="breadcrumb-item active">Demographics Report</li>
    </ol>
}

<div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start;">
    <div>
        <h2><i class="mdi mdi-account-group"></i> @ViewBag.ReportTitle</h2>
        <p class="subtitle">@ViewBag.GrantCycle - Student Teacher Stipend Program</p>
    </div>
    <div class="report-actions">
        <button class="r4-button r4-button-secondary" onclick="window.print();">
            <i class="mdi mdi-printer"></i> Print
        </button>
        <button class="r4-button r4-button-primary" onclick="alert('PDF export coming soon');">
            <i class="mdi mdi-file-pdf-box"></i> Export PDF
        </button>
        <button class="r4-button r4-button-secondary" onclick="alert('Excel export coming soon');">
            <i class="mdi mdi-file-excel"></i> Export Excel
        </button>
    </div>
</div>

<!-- Report Metadata -->
<div class="r4-card">
    <div class="r4-card-body" style="display: flex; justify-content: space-between; padding: 1rem 1.5rem; background: var(--gray-100);">
        <div><strong>Grant Cycle:</strong> @ViewBag.GrantCycle</div>
        <div><strong>Program:</strong> Student Teacher Stipend Program</div>
        <div><strong>Generated:</strong> @((DateTime)ViewBag.GeneratedDate).ToString("MMMM d, yyyy h:mm tt")</div>
    </div>
</div>

<!-- Summary Cards -->
<div class="r4-card">
    <div class="r4-card-header">
        <h4><i class="mdi mdi-chart-box-outline"></i> Summary</h4>
    </div>
    <div class="r4-card-body">
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem;">
            <div class="metric-card metric-card-primary">
                <div class="metric-icon"><i class="mdi mdi-account-group"></i></div>
                <div class="metric-content">
                    <div class="metric-label">Total Students</div>
                    <div class="metric-value">@students.Length</div>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-icon"><i class="mdi mdi-domain"></i></div>
                <div class="metric-content">
                    <div class="metric-label">LEAs Participating</div>
                    <div class="metric-value">5</div>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-icon"><i class="mdi mdi-school"></i></div>
                <div class="metric-content">
                    <div class="metric-label">IHEs Participating</div>
                    <div class="metric-value">5</div>
                </div>
            </div>
            <div class="metric-card metric-card-success">
                <div class="metric-icon"><i class="mdi mdi-currency-usd"></i></div>
                <div class="metric-content">
                    <div class="metric-label">Total Awarded</div>
                    <div class="metric-value">$100,000</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Credential Area Breakdown -->
<div class="r4-card">
    <div class="r4-card-header">
        <h4><i class="mdi mdi-certificate-outline"></i> Credential Area Breakdown</h4>
    </div>
    <div class="r4-card-body">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <div>
                <table class="r4-table">
                    <thead>
                        <tr>
                            <th>Credential Area</th>
                            <th style="text-align: right;">Students</th>
                            <th style="text-align: right;">Percentage</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in credentialBreakdown)
                        {
                            <tr>
                                <td>@item.Area</td>
                                <td style="text-align: right;">@item.Count</td>
                                <td style="text-align: right;">@item.Percent.ToString("F1")%</td>
                            </tr>
                        }
                    </tbody>
                    <tfoot>
                        <tr style="font-weight: 600; background: var(--gray-100);">
                            <td>Total</td>
                            <td style="text-align: right;">@students.Length</td>
                            <td style="text-align: right;">100%</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div style="display: flex; align-items: center; justify-content: center;">
                <canvas id="credentialChart" style="max-height: 250px;"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Regional Breakdown -->
<div class="r4-card">
    <div class="r4-card-header">
        <h4><i class="mdi mdi-map-marker-outline"></i> Regional Distribution</h4>
    </div>
    <div class="r4-card-body">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
            @foreach (var region in regionBreakdown)
            {
                <div style="text-align: center; padding: 1.5rem; border: 1px solid var(--gray-300); border-radius: 8px;">
                    <div style="font-size: 2rem; font-weight: 700; color: var(--ctc-blue);">@region.Count</div>
                    <div style="font-size: 0.875rem; color: var(--gray-600);">@region.Region</div>
                    <div style="font-size: 0.75rem; color: var(--gray-500);">@region.Percent.ToString("F0")% of total</div>
                </div>
            }
        </div>
    </div>
</div>

<!-- Student Detail Table -->
<div class="r4-card">
    <div class="r4-card-header">
        <h4><i class="mdi mdi-table"></i> Student Details</h4>
    </div>
    <div class="r4-card-body">
        <table class="r4-table">
            <thead>
                <tr>
                    <th>Student Name</th>
                    <th>SEID</th>
                    <th>LEA</th>
                    <th>IHE</th>
                    <th>Credential Area</th>
                    <th style="text-align: right;">Award Amount</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var student in students)
                {
                    <tr>
                        <td>@student.Name</td>
                        <td><code>@student.SEID</code></td>
                        <td>@student.LEA</td>
                        <td>@student.IHE</td>
                        <td>@student.CredentialArea</td>
                        <td style="text-align: right;">@student.Amount.ToString("C0")</td>
                        <td><span class="status-badge status-success">@student.Status</span></td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Report Footer -->
<div style="margin-top: 2rem; padding: 1rem; border-top: 1px solid var(--gray-300); color: var(--gray-500); font-size: 0.75rem; display: flex; justify-content: space-between;">
    <div>California Commission on Teacher Credentialing - Confidential Internal Use Only</div>
    <div>Generated: @((DateTime)ViewBag.GeneratedDate).ToString("MM/dd/yyyy HH:mm")</div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        const credentialData = {
            labels: ['Multiple Subject', 'Single Subject - Math', 'Single Subject - English', 'Single Subject - Science', 'Education Specialist'],
            datasets: [{
                data: [3, 2, 1, 1, 3],
                backgroundColor: ['#1E3A5F', '#0066CC', '#C69214', '#28A745', '#17A2B8'],
                borderColor: '#FFFFFF',
                borderWidth: 2
            }]
        };

        new Chart(document.getElementById('credentialChart'), {
            type: 'doughnut',
            data: credentialData,
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { padding: 15, usePointStyle: true }
                    }
                }
            }
        });
    </script>
}

<style>
    @@media print {
        .breadcrumb, .report-actions, .r4-sidebar, .r4-header { display: none !important; }
        .r4-card { break-inside: avoid; box-shadow: none !important; border: 1px solid #ccc; }
    }
</style>
