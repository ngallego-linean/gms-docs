@model ReportingDashboardViewModel

@{
    ViewData["Title"] = "Reporting Dashboard";
}

@section Breadcrumbs {
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "GrantsTeam")">Grants Team</a></li>
        <li class="breadcrumb-item active">Reporting</li>
    </ol>
}

<div class="page-header">
    <h2><i class="mdi mdi-chart-line"></i> Reporting Dashboard</h2>
    <p class="subtitle">Oversight and tracking for post-payment reporting</p>
</div>

@* ACTION ITEMS *@
<div class="r4-card">
    <div class="r4-card-header">
        <h4><i class="mdi mdi-bell-outline"></i> ACTION ITEMS</h4>
    </div>
    <div class="r4-card-body">
        @if (Model.Metrics.ReportsSubmitted > 0 || Model.Metrics.ReportsOutstanding > 0)
        {
            @if (Model.Metrics.ReportsSubmitted > 0)
            {
                <div class="alert alert-warning">
                    <i class="mdi mdi-alert-outline"></i>
                    <strong>@Model.Metrics.ReportsSubmitted report@(Model.Metrics.ReportsSubmitted != 1 ? "s" : "") waiting for review</strong>
                    <div class="mt-2">
                        <a href="@Url.Action("Submitted", "Reporting", new { status = "SUBMITTED" })" class="r4-button r4-button-sm r4-button-primary">
                            <i class="mdi mdi-eye-outline"></i> Review Now
                        </a>
                    </div>
                </div>
            }
            @if (Model.Metrics.ReportsOutstanding > 0)
            {
                <div class="alert alert-danger">
                    <i class="mdi mdi-alert-circle-outline"></i>
                    <strong>@Model.Metrics.ReportsOutstanding report@(Model.Metrics.ReportsOutstanding != 1 ? "s" : "") overdue</strong>
                    <div class="mt-2">
                        <a href="@Url.Action("Outstanding", "Reporting")" class="r4-button r4-button-sm r4-button-danger">
                            <i class="mdi mdi-alert"></i> View Outstanding
                        </a>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="alert alert-success">
                <i class="mdi mdi-check-circle-outline"></i>
                All caught up! No reports currently need immediate attention.
            </div>
        }
    </div>
</div>

@* Report Metrics Overview *@
<div class="r4-card">
    <div class="r4-card-header">
        <h4><i class="mdi mdi-chart-bar"></i> Reporting Metrics</h4>
        <div class="card-actions">
            <a href="@Url.Action("Submitted", "Reporting")" class="r4-button r4-button-primary">
                <i class="mdi mdi-file-document-multiple-outline"></i> View All Reports
            </a>
        </div>
    </div>
    <div class="r4-card-body">
        <div class="dashboard-grid">
            <div class="metric-card metric-submitted">
                <div class="metric-icon">
                    <i class="mdi mdi-file-check-outline"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value">@Model.Metrics.ReportsSubmitted</div>
                    <div class="metric-label">Reports Submitted</div>
                    <div class="metric-description">Awaiting review</div>
                </div>
            </div>

            <div class="metric-card metric-outstanding">
                <div class="metric-icon">
                    <i class="mdi mdi-alert-circle-outline"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value">@Model.Metrics.ReportsOutstanding</div>
                    <div class="metric-label">Reports Outstanding</div>
                    <div class="metric-description">Still due from grantees</div>
                </div>
            </div>

            <div class="metric-card metric-pending">
                <div class="metric-icon">
                    <i class="mdi mdi-eye-outline"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value">@Model.Metrics.ReportsUnderReview</div>
                    <div class="metric-label">Under Review</div>
                    <div class="metric-description">Currently being reviewed</div>
                </div>
            </div>

            <div class="metric-card metric-approved">
                <div class="metric-icon">
                    <i class="mdi mdi-check-circle-outline"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value">@Model.Metrics.ReportsApproved</div>
                    <div class="metric-label">Reports Approved</div>
                    <div class="metric-description">Accepted and complete</div>
                </div>
            </div>

            <div class="metric-card metric-revisions">
                <div class="metric-icon">
                    <i class="mdi mdi-pencil-outline"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value">@Model.Metrics.RevisionsRequested</div>
                    <div class="metric-label">Revisions Requested</div>
                    <div class="metric-description">Requiring corrections</div>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon">
                    <i class="mdi mdi-percent-outline"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value">@Model.Metrics.ComplianceRate.ToString("F1")%</div>
                    <div class="metric-label">Compliance Rate</div>
                    <div class="metric-description">Overall reporting compliance</div>
                </div>
            </div>
        </div>

        <div class="budget-progress">
            <h5>Reporting Progress</h5>
            <div class="r4-progress">
                @{
                    var totalReports = Model.Metrics.ReportsApproved + Model.Metrics.ReportsUnderReview + Model.Metrics.ReportsSubmitted + Model.Metrics.RevisionsRequested;
                    var approvedPercent = totalReports > 0 ? (decimal)Model.Metrics.ReportsApproved / totalReports * 100 : 0;
                    var underReviewPercent = totalReports > 0 ? (decimal)Model.Metrics.ReportsUnderReview / totalReports * 100 : 0;
                    var submittedPercent = totalReports > 0 ? (decimal)Model.Metrics.ReportsSubmitted / totalReports * 100 : 0;
                }
                @if (approvedPercent > 0.1m)
                {
                    <div class="r4-progress-bar r4-progress-bar-success"
                         style="width: @approvedPercent%"
                         role="progressbar"
                         aria-valuenow="@approvedPercent" aria-valuemin="0" aria-valuemax="100">
                        Approved @approvedPercent.ToString("F1")%
                    </div>
                }
                @if (underReviewPercent > 0.1m)
                {
                    <div class="r4-progress-bar r4-progress-bar-primary"
                         style="width: @underReviewPercent%"
                         role="progressbar"
                         aria-valuenow="@underReviewPercent" aria-valuemin="0" aria-valuemax="100">
                        Under Review @underReviewPercent.ToString("F1")%
                    </div>
                }
                @if (submittedPercent > 0.1m)
                {
                    <div class="r4-progress-bar r4-progress-bar-secondary"
                         style="width: @submittedPercent%"
                         role="progressbar"
                         aria-valuenow="@submittedPercent" aria-valuemin="0" aria-valuemax="100">
                        Submitted @submittedPercent.ToString("F1")%
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@* Action Links *@
<div class="r4-card">
    <div class="r4-card-header">
        <h4><i class="mdi mdi-folder-open-outline"></i> Quick Actions</h4>
    </div>
    <div class="r4-card-body">
        <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
            <a href="@Url.Action("Submitted", "Reporting", new { status = "SUBMITTED" })" class="metric-card-link">
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="mdi mdi-file-document-outline"></i>
                    </div>
                    <div class="metric-content">
                        <div class="metric-label">Submitted Reports</div>
                        <div class="metric-description">Review newly submitted reports</div>
                    </div>
                </div>
            </a>

            <a href="@Url.Action("Outstanding", "Reporting")" class="metric-card-link">
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="mdi mdi-alert-outline"></i>
                    </div>
                    <div class="metric-content">
                        <div class="metric-label">Outstanding Reports</div>
                        <div class="metric-description">Track overdue reports</div>
                    </div>
                </div>
            </a>

            <a href="@Url.Action("Analytics", "Reporting")" class="metric-card-link">
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="mdi mdi-chart-line"></i>
                    </div>
                    <div class="metric-content">
                        <div class="metric-label">Analytics</div>
                        <div class="metric-description">View aggregate outcomes</div>
                    </div>
                </div>
            </a>

            <a href="@Url.Action("Compliance", "Reporting")" class="metric-card-link">
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="mdi mdi-clipboard-check-outline"></i>
                    </div>
                    <div class="metric-content">
                        <div class="metric-label">Compliance</div>
                        <div class="metric-description">LEA compliance tracking</div>
                    </div>
                </div>
            </a>
        </div>
    </div>
</div>

@if (Model.Metrics.NextReportingDeadline.HasValue)
{
    <div class="r4-card">
        <div class="r4-card-header">
            <h4><i class="mdi mdi-calendar-clock"></i> Upcoming Deadline</h4>
        </div>
        <div class="r4-card-body">
            <div class="alert alert-info">
                <i class="mdi mdi-information-outline"></i>
                <strong>Next Reporting Deadline:</strong> @Model.Metrics.NextReportingDeadline.Value.ToString("MMMM d, yyyy")
                @{
                    var daysUntil = (Model.Metrics.NextReportingDeadline.Value - DateTime.Now).Days;
                }
                @if (daysUntil < 0)
                {
                    <span class="badge badge-danger">@Math.Abs(daysUntil) days overdue</span>
                }
                else if (daysUntil < 30)
                {
                    <span class="badge badge-warning">@daysUntil days remaining</span>
                }
                else
                {
                    <span class="badge badge-secondary">@daysUntil days remaining</span>
                }
            </div>

            @if (Model.UpcomingDeadlines.Any())
            {
                <div class="table-wrapper">
                    <table class="r4-table">
                        <thead>
                            <tr>
                                <th>LEA</th>
                                <th>IHE</th>
                                <th>Deadline</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var deadline in Model.UpcomingDeadlines.Take(10))
                            {
                                <tr>
                                    <td>@deadline.LEAName</td>
                                    <td>@deadline.IHEName</td>
                                    <td>@deadline.ReportingDeadline.ToString("MMM d, yyyy")</td>
                                    <td>
                                        @if (deadline.IsOverdue)
                                        {
                                            <span class="badge badge-danger">@Math.Abs(deadline.DaysUntilDue) days overdue</span>
                                        }
                                        else if (deadline.DaysUntilDue < 14)
                                        {
                                            <span class="badge badge-warning">@deadline.DaysUntilDue days left</span>
                                        }
                                        else
                                        {
                                            <span class="badge badge-secondary">@deadline.DaysUntilDue days left</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
}
